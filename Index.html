<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LLM Deep Dive ‚Äì Vollst√§ndige Erkl√§rung (Interaktiv)</title>
<style>
    :root{
        --bg:#f8fafc;--card:#ffffff;--ink:#0f172a;--muted:#475569;--brand:#6366f1;--brand-2:#7c3aed;
        --ok:#16a34a;--warn:#f59e0b;--err:#ef4444;--info:#0ea5e9;--line:#e2e8f0;
    }
    *{box-sizing:border-box}
    body{
        margin:0;background:var(--bg);color:var(--ink);font-family: "Segoe UI", system-ui, -apple-system, Arial, sans-serif;line-height:1.6;
    }
    h1,h2,h3{margin:0 0 .25rem 0}
    .container{max-width: 1200px; margin:0 auto; padding:20px}
    .header{display:flex;gap:16px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .title{font-size:32px; font-weight:800; color:#1e293b}
    .path-indicator{
        background:#f1f5f9;border-left:4px solid var(--brand); padding:14px 16px; border-radius:10px; margin:16px 0;
        font-size:14px
    }
    .controls{display:flex; gap:10px; flex-wrap:wrap; margin:12px 0}
    .btn{
        background: #3b82f6; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600;
        transition:.2s background; font-size:14px
    }
    .btn:hover{background:#2563eb}
    .btn.secondary{background:#64748b}
    .btn.secondary:hover{background:#475569}
    .btn.ghost{background:#fff;color:#334155;border:1px solid var(--line)}
    .mindmap{background:var(--card); border-radius:14px; padding:20px; box-shadow:0 8px 25px rgba(0,0,0,.08)}
    /* Knoten-Karten */
    .node{
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color:#fff; padding:18px 20px; border-radius:16px; cursor:pointer; margin:14px 0; position:relative;
        transition: all .25s ease; box-shadow:0 6px 18px rgba(0,0,0,.15); width:100%;
    }
    .node:hover{ transform: translateY(-3px); box-shadow:0 10px 28px rgba(0,0,0,.18) }
    .node .tagline{display:block; font-size:13px; opacity:.9; margin-top:2px}
    .node .expand-icon{ position:absolute; right:16px; top:50%; transform: translateY(-50%); transition: transform .25s ease; font-size:16px }
    .node.expanded .expand-icon{ transform: translateY(-50%) rotate(90deg) }
    /* Level-Farben */
    .level-0{ background:linear-gradient(135deg,#6366f1 0%, #7c3aed 100%); font-size:22px; font-weight:800 }
    .level-1{ background:linear-gradient(135deg,#ffecd2 0%, #fcb69f 100%); color:#111827 }
    .level-2{ background:linear-gradient(135deg,#a8edea 0%, #fed6e3 100%); color:#111827 }
    .level-3{ background:linear-gradient(135deg,#d299c2 0%, #fef9d7 100%); color:#111827 }
    .level-4{ background:linear-gradient(135deg,#89f7fe 0%, #66a6ff 100%); color:#fff }
    .level-5{ background:linear-gradient(135deg,#ffeaa7 0%, #fab1a0 100%); color:#111827 }
    /* Container der Unterabschnitte: KEINE EINR√úCKUNG */
    .children{
        margin: 0; padding: 0; max-height:0; overflow:hidden; transition:max-height .5s ease;
    }
    .children.expanded{ max-height: 10000px }
    /* Inhaltliche K√§sten */
    .section{
        background:#fff; color:#0f172a; border:1px solid var(--line); border-radius:12px; padding:16px; margin:12px 0
    }
    .example-box{
        background:#e0f2fe; border-left:4px solid var(--info); padding:12px; border-radius:6px; margin:12px 0
    }
    .math-formula{
        background:#fef7cd; border:1px dashed #eab308; border-radius:8px; padding:10px; text-align:center; font-family:"Times New Roman", serif
    }
    .code-block{
        background:#0b1220; color:#e2e8f0; border-radius:10px; padding:14px; overflow:auto; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
        position:relative; margin:12px 0
    }
    .copy-btn{ position:absolute; right:10px; top:10px; background:#1f2937; color:#e5e7eb; border:1px solid #334155; border-radius:6px; padding:4px 8px; cursor:pointer; font-size:12px }
    .visual-diagram{ background:#f8fafc; border:2px solid var(--line); border-radius:10px; padding:14px; margin:12px 0 }
    .flow{ text-align:center }
    svg{ max-width:100%; height:auto }
    .chip{
        display:inline-block; background:#eef2ff; color:#3730a3; border:1px solid #c7d2fe; padding:2px 8px; border-radius:999px; font-size:12px; margin:4px 6px 0 0; cursor:pointer
    }
    .crossdeps{ border-top:1px dashed var(--line); margin-top:10px; padding-top:8px; font-size:13px; color:var(--muted) }
    .highlight{
        animation: flash 1.2s ease-out 1; box-shadow:0 0 0 3px rgba(99,102,241,.35) inset;
    }
    @keyframes flash{ 0%{ background: #fffbe6 } 50%{ background:#eef2ff } 100%{ background:transparent } }
    .zoom-controls{
        position:fixed; right:18px; top:18px; background:#fff; border:1px solid var(--line); border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.08);
        padding:10px; z-index:50
    }
    .zoom-btn{
        display:block; width:42px;height:42px;border-radius:50%;border:none;background:#6366f1;color:#fff;cursor:pointer;font-size:18px;margin:6px auto
    }
    .note{font-size:12px;color:var(--muted)}
    .legend{display:flex; flex-wrap:wrap; gap:8px; margin-top:6px}
    .legend span{font-size:12px; padding:4px 8px; border-radius:6px; background:#f1f5f9; border:1px solid var(--line)}
    /* Breadcrumb */
    .breadcrumb{ font-weight:600 }
    /* Responsiv */
    @media (max-width: 720px){
        .title{font-size:24px}
    }
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="title">üß† LLM Deep Dive ‚Äì Die vollst√§ndige, interaktive Erkl√§rung</div>
        <div class="controls">
            <button class="btn" onclick="expandAll()">üîÑ Alles aufklappen</button>
            <button class="btn secondary" onclick="collapseAll()">üìÅ Alles zuklappen</button>
            <button class="btn ghost" onclick="resetView()">üè† Zur√ºck zum Start</button>
        </div>
    </div>

    <div class="path-indicator">
        <div><strong>üó∫Ô∏è Navigation:</strong> Klicke auf eine Karte, um Unterkapitel zu √∂ffnen/schlie√üen. Tiefe Ebenen erscheinen **direkt darunter** (ohne Einr√ºckung).</div>
        <div><strong>Aktueller Pfad:</strong> <span id="breadcrumb" class="breadcrumb">Start</span></div>
        <div class="legend">
            <span>üìê Formeln</span><span>üëÅÔ∏è Diagramme</span><span>üíª Code</span><span>üîó Cross‚ÄëDependencies</span>
        </div>
    </div>

    <div class="zoom-controls">
        <button class="zoom-btn" onclick="zoomIn()">+</button>
        <button class="zoom-btn" onclick="zoomOut()">‚àí</button>
        <button class="zoom-btn" onclick="resetZoom()">‚åÇ</button>
    </div>

    <div class="mindmap" id="mindmap" style="transform-origin: top left;">
        <!-- ROOT -->
        <div id="root" class="node level-0" data-path="LLM Deep Dive" onclick="toggleChildren(event,this)">
            üß≠ LLM von Grund auf: Von Tokens zu Antworten
            <span class="expand-icon">‚ñ∂</span>
            <small class="tagline">Tokenizer ‚Üí Embeddings/Position ‚Üí Transformer‚ÄëBlock ‚Üí Training ‚Üí Decoding ‚Üí Inferenz ‚Üí RAG/Tools ‚Üí Evaluation</small>

            <div class="children">

                <!-- EBENE 1: TOKENIZER -->
                <div id="tokenizer" class="node level-1" data-path="Tokenizer" onclick="toggleChildren(event,this)">
                    üî§ Ebene 1: Tokenizer ‚Äì Wie Text zu Bausteinen wird
                    <span class="expand-icon">‚ñ∂</span>
                    <small class="tagline">Byte‚ÄëBPE & Unigram, Sondertoken, Unicode/Normalisierung, OOV, L√§ngen/Kosten ‚Üî Einfluss auf alle folgenden Ebenen</small>
                    <div class="children">

                        <!-- Warum Subw√∂rter -->
                        <div id="tok-why" class="node level-2" data-path="Warum Subw√∂rter?" onclick="toggleChildren(event,this)">
                            ‚ùì Warum Subw√∂rter statt W√∂rter/Zeichen?
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>Motivation:</strong> Wortbasierte Vokabulare f√ºhren bei seltenen/komplexen W√∂rtern zu <em>UNK</em> (unbekannt). Zeichenbasierte Modelle explodieren in der Sequenzl√§nge. <strong>Subw√∂rter</strong> (BPE/Unigram) sind der Kompromiss: robust gegen OOV, aber deutlich k√ºrzere Sequenzen.</p>
                                    <div class="visual-diagram">
                                        <div class="flow">
                                            <svg viewBox="0 0 880 220">
                                                <rect x="10" y="20" width="260" height="180" rx="10" fill="#fff" stroke="#94a3b8" />
                                                <text x="140" y="40" text-anchor="middle" font-size="14" font-weight="bold">Wort‚Äëbasiert</text>
                                                <text x="140" y="70" text-anchor="middle" font-size="12">"unhappiness" ‚Üí [UNK]</text>
                                                <text x="140" y="95" text-anchor="middle" font-size="12">V=2 Mio, kurz L</text>
                                                <text x="140" y="120" text-anchor="middle" font-size="12" fill="#ef4444">‚ùå Viele UNKs</text>

                                                <rect x="310" y="20" width="260" height="180" rx="10" fill="#fff" stroke="#94a3b8" />
                                                <text x="440" y="40" text-anchor="middle" font-size="14" font-weight="bold">Zeichen‚Äëbasiert</text>
                                                <text x="440" y="70" text-anchor="middle" font-size="12">"unhappiness" ‚Üí 11 Zeichen</text>
                                                <text x="440" y="95" text-anchor="middle" font-size="12">V‚âà200, sehr lang L</text>
                                                <text x="440" y="120" text-anchor="middle" font-size="12" fill="#f59e0b">‚ö†Ô∏è L¬≤‚ÄëKosten</text>

                                                <rect x="610" y="20" width="260" height="180" rx="10" fill="#fff" stroke="#94a3b8" />
                                                <text x="740" y="40" text-anchor="middle" font-size="14" font-weight="bold">Subwort‚Äëbasiert</text>
                                                <text x="740" y="70" text-anchor="middle" font-size="12">"un‚Äëhapp‚Äëi‚Äëness"</text>
                                                <text x="740" y="95" text-anchor="middle" font-size="12">V‚âà50k, moderates L</text>
                                                <text x="740" y="120" text-anchor="middle" font-size="12" fill="#16a34a">‚úÖ Balance</text>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="crossdeps">
                                        üîó <strong>Cross‚ÄëDependencies:</strong>
                                        <span class="chip" onclick="jumpTo('inference')">Inferenz‚ÄëKosten</span>
                                        <span class="chip" onclick="jumpTo('embeddings')">Embedding‚ÄëMatrix</span>
                                        <span class="chip" onclick="jumpTo('decoding')">Decoding‚ÄëStil</span>
                                        <span class="chip" onclick="jumpTo('training')">Datenmischung</span>
                                        <span class="note">Mehr Tokens ‚Üí h√∂here L¬≤‚ÄëAufw√§nde (Attention), mehr Speicher im KV‚ÄëCache.</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- BPE Training -->
                        <div id="tok-bpe" class="node level-2" data-path="Byte-Pair Encoding" onclick="toggleChildren(event,this)">
                            ‚úÇÔ∏è Byte‚ÄëPair Encoding (BPE) ‚Äì Training & Encoding
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>Idee:</strong> Beginne mit Zeichen. F√ºhre iterativ die <em>h√§ufigste Paarzusammenf√ºgung</em> durch (z.‚ÄØB. <code>p</code>+<code>p</code>‚Üí<code>pp</code>), bis Wortschatzgr√∂√üe erreicht ist. Encoding wiederholt diese Merges deterministisch.</p>
                                    <div class="example-box">
                                        <strong>Mini‚ÄëBeispiel (fiktive H√§ufigkeiten):</strong><br>
                                        "unhappiness" ‚Üí ['u','n','h','a','p','p','i','n','e','s','s']<br>
                                        h√§ufigste Paare: <code>p+p</code>, <code>n+e</code>, <code>ne+s</code>... ‚Üí Merges: <code>pp</code>, <code>ne</code>, <code>nes</code>‚Ä¶<br>
                                        Ergebnis: <code>["un","happ","i","ness"]</code>
                                    </div>
                                    <div class="code-block"><button class="copy-btn" onclick="copyCode(this)">Copy</button><pre>
# Vereinfachter BPE-Trainingsablauf (Pseudocode)
counts = count_pair_frequencies(corpus_chars)
vocab = set(chars)
merges = []
while len(vocab) &lt; target_vocab:
    (a,b) = argmax_pair(counts)      # h√§ufigstes Paar
    new_sym = a+b
    merges.append((a,b))
    vocab.add(new_sym)
    corpus_chars = merge_all(corpus_chars, (a,b))
    counts = update_pair_counts(counts, corpus_chars)
# Encoding: wende merges in dieser Reihenfolge auf neuen Text an</pre></div>
                                    <div class="crossdeps">
                                        üîó <strong>Cross‚ÄëDependencies:</strong>
                                        <span class="chip" onclick="jumpTo('tok-sp')">Unigram/SentencePiece</span>
                                        <span class="chip" onclick="jumpTo('embeddings')">Weight‚ÄëTying</span>
                                        <span class="chip" onclick="jumpTo('training')">Data Dedup</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Unigram -->
                        <div id="tok-sp" class="node level-2" data-path="Unigram (SentencePiece)" onclick="toggleChildren(event,this)">
                            üßÆ Unigram (SentencePiece) ‚Äì Probabilistische Alternative
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>Unigram‚ÄëModell:</strong> Starte mit gro√üem Subwortkandidaten‚ÄëSet und <em>entferne</em> nacheinander Eintr√§ge, die die Likelihood kaum verschlechtern. Encoding w√§hlt die Subwortzerlegung mit maximaler Wahrscheinlichkeit (Viterbi/Dynamische Programmierung).</p>
                                    <div class="math-formula"><strong>Objektiv:</strong> maximiere <code>‚àè_tokens p(token)</code> √ºber alle Zerlegungen eines Wortes</div>
                                    <p><em>Praktisch:</em> Besser bei agglutinierenden Sprachen; "weichere" Zerlegungen als BPE.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Sondertoken & Unicode -->
                        <div id="tok-special" class="node level-2" data-path="Sondertoken & Unicode" onclick="toggleChildren(event,this)">
                            üîñ Sondertoken, Leerzeichen, Unicode & Normalisierung
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <ul>
                                        <li><strong>Sondertoken:</strong> BOS/EOS, Padding, Masken; in Chats zus√§tzlich Rollen (system/user/assistant).</li>
                                        <li><strong>Whitespace:</strong> Viele Tokenizer modellieren f√ºhrende Leerzeichen explizit (z.‚ÄØB. ‚Äûƒ†‚Äú).</li>
                                        <li><strong>Unicode:</strong> Normalisierung (z.‚ÄØB. NFKC) vermeidet ‚Äû√ü‚Äú vs. ‚Äûss‚Äú/‚Äû≈ø‚Äú, ‚Äû‚Äô‚Äú vs. ‚Äû'‚Äú ‚Üí <em>gleiche</em> Tokenisierung.</li>
                                        <li><strong>Byte‚ÄëFallback:</strong> Sicherer Pfad f√ºr v√∂llig unbekannte Zeichen ‚Äì nie ‚Äûunk‚Äú.</li>
                                    </ul>
                                    <div class="visual-diagram">
                                        <svg viewBox="0 0 800 180">
                                            <rect x="20" y="20" width="220" height="60" rx="10" fill="#fff" stroke="#94a3b8"/>
                                            <text x="130" y="45" text-anchor="middle" font-size="12">"Stra√üe" / "Strasse"</text>
                                            <text x="130" y="65" text-anchor="middle" font-size="12">NFKC ‚Üí gleiche Tokens</text>

                                            <path d="M 240 50 L 300 50" stroke="#334155" stroke-width="2" marker-end="url(#arr1)"/>
                                            <rect x="310" y="20" width="220" height="60" rx="10" fill="#ecfeff" stroke="#06b6d4"/>
                                            <text x="420" y="45" text-anchor="middle" font-size="12">["ƒ†Stra", "√üe"] = ["ƒ†Stra", "sse"]</text>

                                            <path d="M 530 50 L 590 50" stroke="#334155" stroke-width="2" marker-end="url(#arr1)"/>
                                            <rect x="600" y="20" width="180" height="60" rx="10" fill="#dcfce7" stroke="#16a34a"/>
                                            <text x="690" y="45" text-anchor="middle" font-size="12">Robustere Modelle</text>

                                            <defs>
                                                <marker id="arr1" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                                    <polygon points="0 0, 10 3.5, 0 7" fill="#334155"/>
                                                </marker>
                                            </defs>
                                        </svg>
                                    </div>
                                    <div class="crossdeps">
                                        üîó <strong>Cross‚ÄëDependencies:</strong>
                                        <span class="chip" onclick="jumpTo('decoding')">Logit‚ÄëBias/Verbote</span>
                                        <span class="chip" onclick="jumpTo('training')">Datenbereinigung</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Wirkung auf L√§nge/Kosten -->
                        <div id="tok-cost" class="node level-2" data-path="Sequenzl√§nge & Kosten" onclick="toggleChildren(event,this)">
                            ‚è±Ô∏è Sequenzl√§nge & Kosten ‚Äì warum der Tokenizer alles beeinflusst
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p>Attention hat <strong>quadratische</strong> Komplexit√§t in der Sequenzl√§nge <code>L</code>. Ein Tokenizer, der konstant 20‚ÄØ% l√§ngere Sequenzen erzeugt, erh√∂ht die Prefill‚ÄëKosten um ~44‚ÄØ%.</p>
                                    <div class="math-formula">Skalierung: <code>O(L¬≤¬∑d)</code> f√ºr QK·µÄ und AV, <code>O(L)</code> pro Token im Decode (mit KV‚ÄëCache)</div>
                                    <div class="crossdeps">
                                        üîó <strong>Cross‚ÄëDependencies:</strong>
                                        <span class="chip" onclick="jumpTo('inference-kv')">KV‚ÄëCache Speicher</span>
                                        <span class="chip" onclick="jumpTo('positional')">Positionskodierung</span>
                                        <span class="chip" onclick="jumpTo('flash')">FlashAttention</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div> <!-- /Tokenizer -->

                <!-- EBENE 2: EMBEDDINGS & POSITION -->
                <div id="embeddings" class="node level-1" data-path="Embeddings & Position" onclick="toggleChildren(event,this)">
                    üß± Ebene 2: Embeddings & Positionskodierung
                    <span class="expand-icon">‚ñ∂</span>
                    <small class="tagline">Token‚ÄëVektoren, Weight‚ÄëTying, Residual‚ÄëStream, Sinus/ROPE/ALiBi und ihre Folgen f√ºr L√§nge & Generalisierung</small>
                    <div class="children">

                        <div id="emb-core" class="node level-2" data-path="Token-Embeddings & LM-Head" onclick="toggleChildren(event,this)">
                            üî° Token‚ÄëEmbeddings & LM‚ÄëHead (Weight‚ÄëTying)
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p>Ein Token‚ÄëIndex <em>i</em> wird per Lookup auf <em>E<sub>i</sub> ‚àà ‚Ñù<sup>d</sup></em> abgebildet (<code>d=d_model</code>). H√§ufig wird der Ausgabelinear‚ÄëLayer <em>W<sub>out</sub></em> mit <em>E·µÄ</em> <strong>geteilt</strong> (Weight‚ÄëTying) ‚Üí weniger Parameter, bessere Generalisierung.</p>
                                    <div class="math-formula">Logits: <code>z = h ¬∑ E·µÄ</code> (bei Tying). Softmax: <code>p = softmax(z)</code></div>
                                    <div class="example-box"><strong>Geometrie:</strong> N√§he im Vektorraum korreliert mit Substituierbarkeit; hochfrequente Tokens pr√§gen die Richtung des ‚ÄûMean‚ÄëVectors‚Äú ‚Üí oft <em>Anisotropie</em> (korrigierbar per Norm/Centering).</div>
                                </div>
                            </div>
                        </div>

                        <div id="positional" class="node level-2" data-path="Positionskodierung" onclick="toggleChildren(event,this)">
                            üìç Positionskodierung: Sinus, ROPE, ALiBi
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <h3>Optionen & Intuition</h3>
                                    <ul>
                                        <li><strong>Sinusoidal (absolut):</strong> fixe Frequenzen, erm√∂glicht relative Abst√§nde via linearen Kombinationen.</li>
                                        <li><strong>ROPE (rotary):</strong> interpretiert Paare von Features als 2D‚ÄëRotation ‚Üí <em>relative</em> Phasenverschiebung in Q/K, gut f√ºr Skalierung √ºber L.</li>
                                        <li><strong>ALiBi:</strong> addiert distanzabh√§ngige Bias‚ÄëTerme in die Scores, bevorzugt lokale Bez√ºge, skaliert schlicht auf gro√üe L.</li>
                                    </ul>
                                    <div class="visual-diagram">
                                        <div class="flow">
                                            <svg viewBox="0 0 860 240">
                                                <text x="110" y="22" text-anchor="middle" font-weight="bold">Sinus</text>
                                                <path d="M20 60 C 60 20, 160 100, 200 60 S 340 20, 380 60" stroke="#7c3aed" fill="none" stroke-width="2"/>
                                                <text x="110" y="120" text-anchor="middle" font-size="12">feste, periodische Muster</text>

                                                <text x="430" y="22" text-anchor="middle" font-weight="bold">ROPE</text>
                                                <circle cx="430" cy="70" r="40" stroke="#0ea5e9" fill="none" stroke-width="2"/>
                                                <line x1="430" y1="70" x2="470" y2="70" stroke="#0ea5e9" stroke-width="2"/>
                                                <text x="430" y="120" text-anchor="middle" font-size="12">Rotation: pos‚Äëabh√§ngiger Winkel</text>

                                                <text x="740" y="22" text-anchor="middle" font-weight="bold">ALiBi</text>
                                                <rect x="660" y="50" width="160" height="40" rx="8" fill="#fff" stroke="#94a3b8"/>
                                                <text x="740" y="74" text-anchor="middle" font-size="12">Score += m ¬∑ Distanz</text>
                                                <text x="740" y="120" text-anchor="middle" font-size="12">einfach, skaliert gut</text>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="math-formula"><strong>ROPE (vereinfacht):</strong> rotiere jedes (q<sub>2k</sub>, q<sub>2k+1</sub>) um Winkel Œ∏(pos, k)</div>
                                    <div class="crossdeps">
                                        üîó <strong>Cross‚ÄëDependencies:</strong>
                                        <span class="chip" onclick="jumpTo('inference')">Lange Kontexte</span>
                                        <span class="chip" onclick="jumpTo('flash')">Speicherzugriffe</span>
                                        <span class="chip" onclick="jumpTo('transformer-mha')">Q/K‚ÄëGeometrie</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="residual" class="node level-2" data-path="Residual-Stream" onclick="toggleChildren(event,this)">
                            üåä Residual‚ÄëStream & Normierung ‚Äì Stabilit√§t & Tiefe
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p>Transformer‚ÄëBl√∂cke addieren <em>Korrekturen</em> zum Residual‚ÄëStrom. <strong>Pre‚ÄëLayerNorm</strong> f√∂rdert stabilen Gradientenfluss; <strong>RMSNorm</strong> ist leichtere Variante ohne Zentrierung.</p>
                                    <div class="math-formula">LayerNorm: <code>LN(x)=Œ≥‚äô(x‚àíŒº)/‚àö(œÉ¬≤+Œµ)+Œ≤</code> ‚Ä¢ RMSNorm: <code>x/‚àöE[x¬≤]</code></div>
                                    <div class="crossdeps">üîó
                                        <span class="chip" onclick="jumpTo('transformer-ffn')">FFN/SwiGLU</span>
                                        <span class="chip" onclick="jumpTo('training')">Stabilit√§ts‚ÄëTricks</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- EBENE 3: TRANSFORMER BLOCK -->
                <div id="transformer" class="node level-1" data-path="Transformer-Block" onclick="toggleChildren(event,this)">
                    üèóÔ∏è Ebene 3: Der Transformer‚ÄëBlock ‚Äì Attention + MLP
                    <span class="expand-icon">‚ñ∂</span>
                    <small class="tagline">Q/K/V, kausale Maske, Multi‚Äë/Grouped‚Äë/Multi‚ÄëQuery‚ÄëAttention, FlashAttention, FFN & Parameterz√§hlung</small>
                    <div class="children">

                        <div id="transformer-mha" class="node level-2" data-path="Multi-Head Attention" onclick="toggleChildren(event,this)">
                            üëÅÔ∏è Multi‚ÄëHead Self‚ÄëAttention (MHSA)
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>Formen:</strong> Batch <em>B</em>, L√§nge <em>L</em>, Dim <em>d</em>, K√∂pfe <em>h</em>, Kopf‚ÄëDim <em>d<sub>h</sub>=d/h</em>.</p>
                                    <div class="math-formula"><code>Attn(Q,K,V)=softmax((QK·µÄ)/‚àöd_h + M) V</code></div>
                                    <div class="visual-diagram">
                                        <div class="flow">
                                            <svg viewBox="0 0 840 260">
                                                <rect x="20" y="20" width="180" height="60" rx="10" fill="#fff" stroke="#94a3b8"/>
                                                <text x="110" y="45" text-anchor="middle" font-size="12">X ‚àà ‚Ñù^{B√óL√ód}</text>
                                                <path d="M 200 50 L 240 50" stroke="#334155" stroke-width="2" marker-end="url(#arr2)"/>
                                                <rect x="250" y="20" width="200" height="60" rx="10" fill="#eef2ff" stroke="#6366f1"/>
                                                <text x="350" y="45" text-anchor="middle" font-size="12">Linear ‚Üí Q,K,V</text>

                                                <path d="M 450 50 L 490 50" stroke="#334155" stroke-width="2" marker-end="url(#arr2)"/>
                                                <rect x="500" y="20" width="150" height="60" rx="10" fill="#ecfeff" stroke="#06b6d4"/>
                                                <text x="575" y="45" text-anchor="middle" font-size="12">Head‚ÄëSplit</text>

                                                <path d="M 575 80 L 575 110" stroke="#334155" stroke-width="2" marker-end="url(#arr2)"/>
                                                <rect x="460" y="110" width="230" height="60" rx="10" fill="#dcfce7" stroke="#16a34a"/>
                                                <text x="575" y="145" text-anchor="middle" font-size="12">softmax((QK·µÄ)/‚àöd_h + M)</text>

                                                <path d="M 575 170 L 575 210" stroke="#334155" stroke-width="2" marker-end="url(#arr2)"/>
                                                <rect x="460" y="210" width="230" height="40" rx="10" fill="#fef3c7" stroke="#f59e0b"/>
                                                <text x="575" y="235" text-anchor="middle" font-size="12">¬∑ V ‚Üí concat ‚Üí Linear W_O</text>

                                                <defs>
                                                    <marker id="arr2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                                        <polygon points="0 0, 10 3.5, 0 7" fill="#334155"/>
                                                    </marker>
                                                </defs>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="example-box">
                                        <strong>Kausale Maske:</strong> Verhindert Blick nach vorn (j&gt;i). <em>Ohne</em> Maske kein autoregressives Generieren.
                                    </div>
                                    <div class="crossdeps">üîó
                                        <span class="chip" onclick="jumpTo('positional')">ROPE/ALiBi</span>
                                        <span class="chip" onclick="jumpTo('inference-kv')">KV‚ÄëCache</span>
                                        <span class="chip" onclick="jumpTo('flash')">FlashAttention</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="mqa-gqa" class="node level-2" data-path="MQA/GQA" onclick="toggleChildren(event,this)">
                            üß† MQA/GQA ‚Äì Speicherleichte Attention‚ÄëVarianten
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>MQA:</strong> mehrere Query‚ÄëK√∂pfe teilen sich <em>ein</em> K/V‚ÄëSatz ‚Üí kleiner KV‚ÄëCache, schnellere Inferenz. <strong>GQA:</strong> Gruppen teilen K/V. Kleiner Trade‚Äëoff in Qualit√§t vs. gro√üe Effizienzgewinne.</p>
                                    <div class="code-block"><button class="copy-btn" onclick="copyCode(this)">Copy</button><pre>
# Skizze: MQA in PyTorch-Stil (Pseudocode)
Q = q_proj(x).view(B,L,h,d_h)          # viele Queries
K = k_proj(x).view(B,L,1,d_h)          # geteilter Key
V = v_proj(x).view(B,L,1,d_h)          # geteilter Value
scores = (Q @ K.transpose(-1,-2)) / sqrt(d_h) + mask
A = softmax(scores, dim=-1)
H = (A @ V)          # broadcasting √ºber den geteilten K/V-Kanal
out = o_proj(merge_heads(H))</pre></div>
                                    <div class="crossdeps">üîó
                                        <span class="chip" onclick="jumpTo('inference-kv')">KV‚ÄëSpeicherrechnung</span>
                                        <span class="chip" onclick="jumpTo('decoding')">Sampling‚ÄëDurchsatz</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="flash" class="node level-2" data-path="FlashAttention" onclick="toggleChildren(event,this)">
                            ‚ö° FlashAttention ‚Äì Speichergebundene Optimierung
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p>Reordnet die Berechnung in Kacheln (Blocks), fusioniert Softmax/Numerik, reduziert Speicherzugriffe ‚Üí <em>real</em> deutlich schneller bei langen Sequenzen.</p>
                                    <div class="example-box"><strong>Insight:</strong> Attention ist h√§ufig <em>memory‚Äë</em> nicht <em>compute‚Äëbound</em>. FlashAttention reduziert HBM‚ÄëTransfers ‚Üí gro√üe Gewinne.</div>
                                </div>
                            </div>
                        </div>

                        <div id="transformer-ffn" class="node level-2" data-path="FFN/SwiGLU" onclick="toggleChildren(event,this)">
                            üîß FFN (MLP) & SwiGLU ‚Äì nichtlineare Projektionen
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p>Expandiere <code>d ‚Üí d_ff</code> (typisch 3‚Äì4√ó), Aktvierung (GELU/SwiGLU), zur√ºck auf <code>d</code>. <strong>SwiGLU</strong> (gated) steigert Qualit√§t bei √§hnlichen FLOPs.</p>
                                    <div class="math-formula">SwiGLU: <code>(XW_a) ‚äô SiLU(XW_b) ¬∑ W_o</code></div>
                                </div>
                            </div>
                        </div>

                        <div id="params" class="node level-2" data-path="Parameterz√§hlung" onclick="toggleChildren(event,this)">
                            üßÆ Parameterz√§hlung ‚Äì konkrete Zahlen (Beispiel)
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p>Beispiel (illustrativ): <code>d=4096</code>, <code>h=32</code> ‚áí <code>d_h=128</code>, <code>d_ff=16384</code>, 32 Layer, Vokab 50k.</p>
                                    <ul>
                                        <li><strong>W_QKV</strong>: 4096√ó(3¬∑4096)=<strong>50,331,648</strong></li>
                                        <li><strong>W_O</strong>: 4096√ó4096=<strong>16,777,216</strong> ‚Üí Attention pro Layer: <strong>67,108,864</strong></li>
                                        <li><strong>W_1</strong>: 4096√ó16384=<strong>67,108,864</strong>, <strong>W_2</strong>: 16384√ó4096=<strong>67,108,864</strong> ‚Üí MLP pro Layer: <strong>134,217,728</strong></li>
                                        <li><strong>Summe pro Layer</strong>: <strong>201,326,592</strong>; bei 32 Layern ‚âà <strong>6,442,450,944</strong></li>
                                        <li><strong>Embeddings</strong> (V=50k): 50k√ó4096=<strong>204,800,000</strong> ‚Üí Gesamt ‚âà <strong>6.65‚ÄØB</strong></li>
                                    </ul>
                                    <div class="note">Zahlen ohne Bias/Normen, exemplarisch; reale Modelle variieren (SwiGLU‚ÄëSkalierung, Tiefe, Heads).</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- EBENE 4: TRAINING / OPTIMIERUNG -->
                <div id="training" class="node level-1" data-path="Training & Optimierung" onclick="toggleChildren(event,this)">
                    üß™ Ebene 4: Training & Optimierung ‚Äì wie die Gewichte entstehen
                    <span class="expand-icon">‚ñ∂</span>
                    <small class="tagline">Next‚ÄëToken‚ÄëZiel, Cross‚ÄëEntropy/Perplexity, Datenpipeline, Optimierer & Schedules, Stabilit√§t, SFT/RLHF/DPO</small>
                    <div class="children">

                        <div id="obj" class="node level-2" data-path="Ziel & Perplexity" onclick="toggleChildren(event,this)">
                            üéØ Objektiv (Next‚ÄëToken), Cross‚ÄëEntropy & Perplexity
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <div class="math-formula">maximiere <code>‚àë‚Çú log p_Œ∏(x_t | x_{&lt;t})</code> ‚Ä¢ CE‚ÄëLoss: <code>L=‚àílog p_Œ∏(y|x_{&lt;t})</code> ‚Ä¢ <strong>PPL</strong>=<code>exp(E[L])</code></div>
                                    <p><strong>Teacher Forcing</strong> im Training (Gold‚ÄëHistorie) vs. <strong>Exposure Bias</strong> in der Generierung (eigene Historie).</p>
                                </div>
                            </div>
                        </div>

                        <div id="data" class="node level-2" data-path="Datenpipeline" onclick="toggleChildren(event,this)">
                            üìö Datenpipeline ‚Äì Mischung, Qualit√§t, Dedup
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <ul>
                                        <li><strong>Mischung:</strong> Web/B√ºcher/Code/Foren/Artikel; balancierte Dom√§nen.</li>
                                        <li><strong>Qualit√§t:</strong> Heuristiken, Sprach/Char‚ÄëFilter, Toxicity‚ÄëFilter, Dokument‚ÄëL√§nge.</li>
                                        <li><strong>Dedup:</strong> Hash/MinHash gegen Leaks/Lehrer‚Äë√úberanpassung.</li>
                                    </ul>
                                    <div class="crossdeps">üîó
                                        <span class="chip" onclick="jumpTo('tokenizer')">Tokenizer‚ÄëVerteilung</span>
                                        <span class="chip" onclick="jumpTo('evaluation')">Eval‚ÄëGeneralisation</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="optim" class="node level-2" data-path="Optimierung" onclick="toggleChildren(event,this)">
                            ‚öôÔ∏è Optimierung ‚Äì AdamW, Schedules & Stabilit√§t
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <ul>
                                        <li><strong>Optimierer:</strong> AdamW; Œ≤=(0.9, 0.95‚Äì0.999), Weight Decay getrennt.</li>
                                        <li><strong>LR‚ÄëSchedule:</strong> Warmup ‚Üí Cosine‚ÄëDecay; gro√üe effektive Batches per Gradient Accumulation.</li>
                                        <li><strong>Stabilit√§t:</strong> Mixed Precision (bf16/fp16), Grad‚ÄëClipping, Pre‚ÄëLN, RMSNorm, Loss‚ÄëSkalierung.</li>
                                        <li><strong>Parallelismus:</strong> Data/Tensor/Pipeline, ZeRO‚ÄëSharding.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div id="alignment" class="node level-2" data-path="SFT/RLHF/DPO" onclick="toggleChildren(event,this)">
                            üéõÔ∏è SFT, RLHF & DPO ‚Äì von rohem LM zu hilfreichem Assistenten
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>SFT</strong> (Supervised Fine‚ÄëTuning) auf Anweisung/Antwort‚ÄëPairs; <strong>RLHF</strong> nutzt Pr√§ferenzmodelle; <strong>DPO</strong> optimiert direkt auf Pr√§ferenzverh√§ltnisse ohne Policy‚ÄëRollouts.</p>
                                    <div class="example-box"><strong>Wichtig:</strong> Alignment √§ndert das <em>Verhalten</em> (Pr√§ferenzen), nicht die Kernf√§higkeit des Next‚ÄëToken‚ÄëModells.</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- EBENE 5: DECODING -->
                <div id="decoding" class="node level-1" data-path="Decoding & Kalibrierung" onclick="toggleChildren(event,this)">
                    üé∞ Ebene 5: Decoding & Kalibrierung ‚Äì vom Logit zur Antwort
                    <span class="expand-icon">‚ñ∂</span>
                    <small class="tagline">Softmax/Temperatur, Top‚Äëk/Top‚Äëp/Typical, Beam & L√§ngenpenalty, Repetition‚ÄëPenalty, Logit‚ÄëBias, Grammatik‚ÄëSampling</small>
                    <div class="children">

                        <div id="softmax" class="node level-2" data-path="Softmax & Temperatur" onclick="toggleChildren(event,this)">
                            üå°Ô∏è Softmax, Temperatur & Kalibrierung
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <div class="math-formula"><code>p_i = exp(z_i/T) / ‚àë_j exp(z_j/T)</code></div>
                                    <div class="example-box">
                                        <strong>Beispiel:</strong> Logits [2.1, 1.3, 0.8, ‚àí0.5] ‚Üí <em>T=1</em>: [0.56, 0.25, 0.15, 0.04].<br>
                                        <em>T=0.7</em> spitzer; <em>T=1.5</em> flacher.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="sampling" class="node level-2" data-path="Sampling-Strategien" onclick="toggleChildren(event,this)">
                            üé≤ Sampling‚ÄëStrategien (Greedy, Top‚Äëk, Top‚Äëp, Typical)
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <ul>
                                        <li><strong>Greedy:</strong> h√∂chstes p ‚Äì deterministisch, repetitiv.</li>
                                        <li><strong>Top‚Äëk:</strong> nur beste k Tokens, renormalisieren.</li>
                                        <li><strong>Top‚Äëp (Nucleus):</strong> kleinste Menge mit kumulativ ‚â• p.</li>
                                        <li><strong>Typical:</strong> Pr√§ferenz f√ºr Tokens nahe Entropie ‚Üí vermeidet ‚Äûzu erwartbare‚Äú und ‚Äûzu √ºberraschende‚Äú.</li>
                                    </ul>
                                    <div class="code-block"><button class="copy-btn" onclick="copyCode(this)">Copy</button><pre>
# Top-p (Nucleus) Sampling, PyTorch-Skizze
def nucleus_sample(logits, p=0.9, temperature=1.0):
    z = logits / temperature
    probs = torch.softmax(z, dim=-1)
    sp, si = torch.sort(probs, descending=True)
    csum = torch.cumsum(sp, dim=-1)
    cutoff = torch.searchsorted(csum, torch.tensor(p, device=csum.device))
    sp[cutoff+1:] = 0.0
    sp = sp / sp.sum()
    idx = torch.multinomial(sp, 1)
    return si.gather(-1, idx)</pre></div>
                                    <div class="crossdeps">üîó
                                        <span class="chip" onclick="jumpTo('alignment')">Pr√§ferenzmodelle</span>
                                        <span class="chip" onclick="jumpTo('inference')">Durchsatz pro Token</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="constraints" class="node level-2" data-path="Nebenbedingungen" onclick="toggleChildren(event,this)">
                            üß© Nebenbedingungen: Beam, L√§ngen‚ÄëPenalty, Repetition/Logit‚ÄëBias, Grammatik
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <ul>
                                        <li><strong>Beam Search:</strong> beh√§lt k beste Hypothesen ‚Äì gut f√ºr deterministische Aufgaben, riskant f√ºr offene Generierung.</li>
                                        <li><strong>L√§ngen‚ÄëPenalty:</strong> verhindert zu kurze Antworten bei Beam.</li>
                                        <li><strong>Repetition Penalty / n‚ÄëGram‚ÄëBlock:</strong> reduziert Wiederholungen.</li>
                                        <li><strong>Logit‚ÄëBias & Stop‚ÄëSeq:</strong> erzwinge/verbiete Muster.</li>
                                        <li><strong>Grammar‚ÄëSampling:</strong> generiere nur Strings, die einer Grammatik entsprechen (JSON/XML etc.).</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- EBENE 6: INFERENCE & EFFIZIENZ -->
                <div id="inference" class="node level-1" data-path="Inferenz & Effizienz" onclick="toggleChildren(event,this)">
                    ‚ö° Ebene 6: Inferenz & Effizienz ‚Äì schnell & speicherschonend
                    <span class="expand-icon">‚ñ∂</span>
                    <small class="tagline">Prefill vs Decode, KV‚ÄëCache‚ÄëMathematik, Paged Attention, Quantisierung, Speculative Decoding</small>
                    <div class="children">

                        <div id="inference-steps" class="node level-2" data-path="Prefill & Decode" onclick="toggleChildren(event,this)">
                            ‚è© Prefill & Decode ‚Äì zwei Phasen
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>Prefill:</strong> gesamten Prompt einmal rechnen (L¬≤‚ÄëAufwand, baut KV‚ÄëCache). <strong>Decode:</strong> pro neuem Token nur letzte Spalte/Zeile (‚àù L) dank Cache.</p>
                                </div>
                            </div>
                        </div>

                        <div id="inference-kv" class="node level-2" data-path="KV-Cache-Rechnung" onclick="toggleChildren(event,this)">
                            üßä KV‚ÄëCache ‚Äì exakte Speicherrechnung (Beispiel)
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p>Beispiel: <em>L=8192</em>, <em>h=32</em>, <em>d_h=128</em>, 2 Matrizen (K&V), Datentyp 2‚ÄØByte (fp16/bf16), Batch=1.</p>
                                    <ul>
                                        <li>Elemente pro Layer: <code>2 √ó L √ó h √ó d_h = 2 √ó 8192 √ó 32 √ó 128 = 67,108,864</code></li>
                                        <li>Bytes pro Layer: <code>‚âà134,217,728</code>‚ÄØB = <strong>128‚ÄØMiB</strong></li>
                                        <li>Bei 32 Layern: <strong>‚âà4‚ÄØGiB</strong> nur Cache</li>
                                    </ul>
                                    <div class="crossdeps">üîó
                                        <span class="chip" onclick="jumpTo('mqa-gqa')">MQA/GQA</span>
                                        <span class="chip" onclick="jumpTo('tokenizer')">Tokenl√§nge</span>
                                        <span class="chip" onclick="jumpTo('positional')">Lange Kontexte</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="quant" class="node level-2" data-path="Quantisierung" onclick="toggleChildren(event,this)">
                            üéöÔ∏è Quantisierung (int8/int4), Outlier‚ÄëHandling & LoRA
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>Ziel:</strong> Gewichte/Aktivierungen in niedrigere Pr√§zision √ºberf√ºhren. <em>Outlier‚ÄëChannels</em> erfordern besondere Behandlung (z.‚ÄØB. Gruppierungs‚Äë/Skalen pro Kanal). <strong>LoRA</strong> f√ºgt Low‚ÄëRank‚ÄëAdapter hinzu (feinabstimmen ohne Full‚Äëfinetune).</p>
                                </div>
                            </div>
                        </div>

                        <div id="spec" class="node level-2" data-path="Speculative Decoding" onclick="toggleChildren(event,this)">
                            üß™ Speculative Decoding ‚Äì schnelleres Sampling
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p>Ein kleiner ‚ÄûDraft‚Äú‚ÄëDecoder schl√§gt eine Sequenz vor; der gro√üe pr√ºft sie in einem Schritt. Bei hoher √úbereinstimmung: erhebliche Geschwindigkeit, da mehrere Tokens pro Verifikation best√§tigt werden.</p>
                                </div>
                            </div>
                        </div>

                        <div id="paged" class="node level-2" data-path="Paged/Sliding Attention" onclick="toggleChildren(event,this)">
                            üìÑ Paged/Sliding Attention ‚Äì Speicher fragmentieren & schieben
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>Paged:</strong> KV‚ÄëCache in Seiten (Paged‚ÄëMemory) ‚Üí weniger Realloc/Fragmentierung. <strong>Sliding‚ÄëWindow:</strong> beschr√§nke Aufmerksamkeit auf letztes Fenster ‚Üí Liniearer Speicherbedarf in L.</p>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- EBENE 7: RAG & TOOLS -->
                <div id="rag" class="node level-1" data-path="RAG & Tools" onclick="toggleChildren(event,this)">
                    üß© Ebene 7: RAG & Tool‚ÄëNutzung ‚Äì Grounding & Erweiterung
                    <span class="expand-icon">‚ñ∂</span>
                    <small class="tagline">Retrieval‚ÄëAugmented Generation, Vektor‚ÄëSuche, Cross‚Äë/Bi‚ÄëEncoder, Funktionsaufrufe</small>
                    <div class="children">

                        <div id="rag-core" class="node level-2" data-path="RAG-Pipeline" onclick="toggleChildren(event,this)">
                            üîé RAG‚ÄëPipeline ‚Äì vom Query zur verankerten Antwort
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <ol>
                                        <li><strong>Embed</strong> Nutzerfrage ‚Üí Vektor.</li>
                                        <li><strong>Retrieve</strong> √§hnliche Passagen (Vektor‚ÄëIndex).</li>
                                        <li><strong>Augment</strong> Prompt mit Kontext.</li>
                                        <li><strong>Generate</strong> Antwort (Next‚ÄëToken wie gehabt) ‚Äì jetzt <em>geerdet</em>.</li>
                                    </ol>
                                    <div class="crossdeps">üîó
                                        <span class="chip" onclick="jumpTo('embeddings')">Embedding‚ÄëQualit√§t</span>
                                        <span class="chip" onclick="jumpTo('decoding')">Kalibrierung</span>
                                        <span class="chip" onclick="jumpTo('training')">Dom√§nenmischung</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="tools" class="node level-2" data-path="Tools/Functions" onclick="toggleChildren(event,this)">
                            üõ†Ô∏è Tools/Function‚ÄëCalling ‚Äì Rechnen, Suche, Code
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <p>Das LM erzeugt strukturierte <em>Aufrufe</em> (z.‚ÄØB. JSON) f√ºr externe Tools; deren Ergebnisse flie√üen als Kontext zur√ºck. Gewichte bleiben unver√§ndert ‚Äì nur die <em>Konditionierung</em> √§ndert sich.</p>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- EBENE 8: EVALUATION & SAFETY -->
                <div id="evaluation" class="node level-1" data-path="Evaluation & Verhalten" onclick="toggleChildren(event,this)">
                    üìè Ebene 8: Evaluation, Kalibrierung & Verhalten
                    <span class="expand-icon">‚ñ∂</span>
                    <small class="tagline">Perplexity vs. Task‚ÄëScores, Halluzination, Unsicherheitskommunikation, Safety‚ÄëHinweise</small>
                    <div class="children">

                        <div id="eval-metrics" class="node level-2" data-path="Metriken" onclick="toggleChildren(event,this)">
                            üìä Metriken ‚Äì was misst was?
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <ul>
                                        <li><strong>Perplexity:</strong> Sprachmodellg√ºte (<em>intrinsisch</em>), nicht gleich Taskleistung.</li>
                                        <li><strong>Extrinsisch:</strong> QA/Code/Reasoning‚ÄëBenchmarks.</li>
                                        <li><strong>Kalibrierung:</strong> passt p(y) zu H√§ufigkeiten?</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div id="eval-safety" class="node level-2" data-path="Safety" onclick="toggleChildren(event,this)">
                            üõ°Ô∏è Verhalten & Safety ‚Äì Grenzen & Praxis
                            <span class="expand-icon">‚ñ∂</span>
                            <div class="children">
                                <div class="section">
                                    <ul>
                                        <li><strong>Halluzination:</strong> fehlende Evidenz ‚Üí plausible Erfindungen. Gegenmittel: RAG/Verweise/Unsicherheiten artikulieren.</li>
                                        <li><strong>Prompt‚ÄëInjektionen:</strong> externe Texte k√∂nnen Instruktionen √ºberschreiben ‚Äì Gegenma√ünahmen: Parser/Filter, sichere Tool‚ÄëSchnittstellen.</li>
                                        <li><strong>Bias & Fairness:</strong> Trainingsdaten pr√§gen Stil & Inhalt.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- EBENE 9: CHEAT-SHEET -->
                <div id="cheatsheet" class="node level-1" data-path="Cheat-Sheet" onclick="toggleChildren(event,this)">
                    üßæ Ebene 9: Cheat‚ÄëSheet ‚Äì das Wichtigste in K√ºrze
                    <span class="expand-icon">‚ñ∂</span>
                    <div class="children">
                        <div class="section">
                            <ul>
                                <li><strong>Modell:</strong> bedingter Next‚ÄëToken‚ÄëGenerator <code>p(x_t|x_{&lt;t})</code>.</li>
                                <li><strong>Kern‚ÄëBlock:</strong> (Norm‚ÜíAttention‚ÜíRes) + (Norm‚ÜíMLP‚ÜíRes).</li>
                                <li><strong>Skalierung:</strong> Kosten ‚àù L¬≤ (Prefill), Speicher ‚àù L¬∑h¬∑d_h¬∑Layer.</li>
                                <li><strong>Decoding:</strong> Top‚Äëp meist robust, Typical f√ºr ‚Äûnat√ºrliche‚Äú Vielfalt.</li>
                                <li><strong>Effizienz:</strong> KV‚ÄëCache, FlashAttention, MQA/GQA, Quantisierung.</li>
                                <li><strong>Grounding:</strong> RAG/Tools, Kalibrierung kommunizieren.</li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div><!-- /children root -->
        </div><!-- /root -->
    </div><!-- /mindmap -->
</div><!-- /container -->

<script>
/* =============== State & Breadcrumb =============== */
let currentZoom = 1;
let breadcrumbPath = ["Start"];

/* Persist offen/zu pro Node (optional) */
const STORAGE_KEY = "llm_deep_dive_open_nodes_v1";

/* Toggle-Handler */
function toggleChildren(ev, node){
    ev.stopPropagation();
    const children = node.querySelector(':scope > .children'); // nur direkte children
    if(!children) return;

    const id = node.id || node.getAttribute('data-path');
    children.classList.toggle('expanded');
    node.classList.toggle('expanded');

    // Breadcrumb aktualisieren (einfacher Heuristikpfad)
    const pathData = node.getAttribute('data-path');
    if(pathData && children.classList.contains('expanded')){
        if(!breadcrumbPath.includes(pathData)) breadcrumbPath.push(pathData);
    } else if(pathData){
        const idx = breadcrumbPath.indexOf(pathData);
        if(idx > -1){ breadcrumbPath.splice(idx); }
    }
    updateBreadcrumb();

    // Persistenz
    saveOpenState();
}
function updateBreadcrumb(){
    document.getElementById('breadcrumb').textContent = breadcrumbPath.join(' ‚Üí ');
}

/* Expand/Collapse All */
function expandAll(){
    document.querySelectorAll('.children').forEach(c => c.classList.add('expanded'));
    document.querySelectorAll('.node').forEach(n => n.classList.add('expanded'));
    // Pfad grob
    breadcrumbPath = ["Start", "Alles ge√∂ffnet"];
    updateBreadcrumb();
    saveOpenState();
}
function collapseAll(){
    document.querySelectorAll('.children').forEach(c => c.classList.remove('expanded'));
    document.querySelectorAll('.node').forEach(n => n.classList.remove('expanded'));
    breadcrumbPath = ["Start"];
    updateBreadcrumb();
    saveOpenState();
}
function resetView(){
    collapseAll();
    resetZoom();
    window.scrollTo({top:0, behavior:"smooth"});
}

/* Zoom */
function applyZoom(){
    document.getElementById('mindmap').style.transform = `scale(${currentZoom})`;
}
function zoomIn(){ currentZoom = Math.min(currentZoom*1.2, 3); applyZoom(); }
function zoomOut(){ currentZoom = Math.max(currentZoom/1.2, 0.5); applyZoom(); }
function resetZoom(){ currentZoom = 1; applyZoom(); }

/* Copy Code */
function copyCode(btn){
    const pre = btn.parentElement.querySelector('pre');
    const text = pre.innerText;
    navigator.clipboard.writeText(text).then(()=>{
        btn.textContent = "Copied!";
        setTimeout(()=>btn.textContent="Copy", 1200);
    }).catch(()=>{ btn.textContent="Error"; setTimeout(()=>btn.textContent="Copy", 1200); });
}

/* Cross-Dependency Jump & Highlight */
function jumpTo(id){
    const el = document.getElementById(id);
    if(!el) return;
    // Stelle sicher, dass Eltern aufgeklappt sind
    openAncestors(el);
    // sanft scrollen + highlight
    el.scrollIntoView({behavior:"smooth", block:"center"});
    el.classList.add('highlight');
    setTimeout(()=>el.classList.remove('highlight'), 1200);
}
function openAncestors(el){
    let cur = el;
    while(cur){
        const parentNode = cur.closest('.children')?.parentElement;
        if(parentNode && parentNode.classList.contains('node')){
            parentNode.classList.add('expanded');
            const ch = parentNode.querySelector(':scope > .children');
            if(ch) ch.classList.add('expanded');
        }
        cur = parentNode;
    }
    saveOpenState();
}

/* Persistenz-Helper */
function saveOpenState(){
    const openIds = Array.from(document.querySelectorAll('.node.expanded')).map(n => n.id || n.getAttribute('data-path'));
    try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(openIds)); }catch(e){}
}
function restoreOpenState(){
    let arr = [];
    try{ arr = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }catch(e){}
    if(!Array.isArray(arr)) return;
    arr.forEach(id =>{
        const n = document.getElementById(id) || document.querySelector(`.node[data-path="${CSS.escape(id)}"]`);
        if(n){
            n.classList.add('expanded');
            const ch = n.querySelector(':scope > .children');
            if(ch) ch.classList.add('expanded');
        }
    });
    if(arr.length){ breadcrumbPath = ["Start", "Fortgesetzte Ansicht"]; updateBreadcrumb(); }
}

/* Init */
document.addEventListener('DOMContentLoaded', ()=>{
    restoreOpenState();
    updateBreadcrumb();
});
</script>
</body>
</html>
