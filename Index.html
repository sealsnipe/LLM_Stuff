<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LLM Deep Dive â€“ VollstÃ¤ndige ErklÃ¤rung (Interaktiv)</title>
<style>
    :root{
        --bg:#f8fafc;--card:#ffffff;--ink:#0f172a;--muted:#475569;--brand:#6366f1;--brand-2:#7c3aed;
        --ok:#16a34a;--warn:#f59e0b;--err:#ef4444;--info:#0ea5e9;--line:#e2e8f0;
    }
    *{box-sizing:border-box}
    body{
        margin:0;background:var(--bg);color:var(--ink);font-family: "Segoe UI", system-ui, -apple-system, Arial, sans-serif;line-height:1.6;
    }
    h1,h2,h3{margin:0 0 .25rem 0}
    .container{max-width: 1200px; margin:0 auto; padding:20px}
    .header{display:flex;gap:16px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .title{font-size:32px; font-weight:800; color:#1e293b}
    .path-indicator{
        background:#f1f5f9;border-left:4px solid var(--brand); padding:14px 16px; border-radius:10px; margin:16px 0;
        font-size:14px
    }
    .controls{display:flex; gap:10px; flex-wrap:wrap; margin:12px 0}
    .btn{
        background: #3b82f6; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600;
        transition:.2s background; font-size:14px
    }
    .btn:hover{background:#2563eb}
    .btn.secondary{background:#64748b}
    .btn.secondary:hover{background:#475569}
    .btn.ghost{background:#fff;color:#334155;border:1px solid var(--line)}
    .mindmap{background:var(--card); border-radius:14px; padding:20px; box-shadow:0 8px 25px rgba(0,0,0,.08)}
    /* Knoten-Karten */
    .node{
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color:#fff; padding:18px 20px; border-radius:16px; cursor:pointer; margin:14px 0; position:relative;
        transition: all .25s ease; box-shadow:0 6px 18px rgba(0,0,0,.15); width:100%;
    }
    .node:hover{ transform: translateY(-3px); box-shadow:0 10px 28px rgba(0,0,0,.18) }
    .node .tagline{display:block; font-size:13px; opacity:.9; margin-top:2px}
    .node .expand-icon{ position:absolute; right:16px; top:50%; transform: translateY(-50%); transition: transform .25s ease; font-size:16px }
    .node.expanded .expand-icon{ transform: translateY(-50%) rotate(90deg) }
    /* Level-Farben */
    .level-0{ background:linear-gradient(135deg,#6366f1 0%, #7c3aed 100%); font-size:22px; font-weight:800 }
    .level-1{ background:linear-gradient(135deg,#ffecd2 0%, #fcb69f 100%); color:#111827 }
    .level-2{ background:linear-gradient(135deg,#a8edea 0%, #fed6e3 100%); color:#111827 }
    .level-3{ background:linear-gradient(135deg,#d299c2 0%, #fef9d7 100%); color:#111827 }
    .level-4{ background:linear-gradient(135deg,#89f7fe 0%, #66a6ff 100%); color:#fff }
    .level-5{ background:linear-gradient(135deg,#ffeaa7 0%, #fab1a0 100%); color:#111827 }
    /* Container der Unterabschnitte: KEINE EINRÃœCKUNG */
    .children{
        margin: 0; padding: 0; max-height:0; overflow:hidden; transition:max-height .5s ease;
    }
    .children.expanded{ max-height: 10000px }
    /* Inhaltliche KÃ¤sten */
    .section{
        background:#fff; color:#0f172a; border:1px solid var(--line); border-radius:12px; padding:16px; margin:12px 0
    }
    .example-box{
        background:#e0f2fe; border-left:4px solid var(--info); padding:12px; border-radius:6px; margin:12px 0
    }
    .math-formula{
        background:#fef7cd; border:1px dashed #eab308; border-radius:8px; padding:10px; text-align:center; font-family:"Times New Roman", serif
    }
    .code-block{
        background:#0b1220; color:#e2e8f0; border-radius:10px; padding:14px; overflow:auto; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
        position:relative; margin:12px 0
    }
    .copy-btn{ position:absolute; right:10px; top:10px; background:#1f2937; color:#e5e7eb; border:1px solid #334155; border-radius:6px; padding:4px 8px; cursor:pointer; font-size:12px }
    .visual-diagram{ background:#f8fafc; border:2px solid var(--line); border-radius:10px; padding:14px; margin:12px 0 }
    .flow{ text-align:center }
    svg{ max-width:100%; height:auto }
    .chip{
        display:inline-block; background:#eef2ff; color:#3730a3; border:1px solid #c7d2fe; padding:2px 8px; border-radius:999px; font-size:12px; margin:4px 6px 0 0; cursor:pointer
    }
    .crossdeps{ border-top:1px dashed var(--line); margin-top:10px; padding-top:8px; font-size:13px; color:var(--muted) }
    .highlight{
        animation: flash 1.2s ease-out 1; box-shadow:0 0 0 3px rgba(99,102,241,.35) inset;
    }
    @keyframes flash{ 0%{ background: #fffbe6 } 50%{ background:#eef2ff } 100%{ background:transparent } }
    .zoom-controls{
        position:fixed; right:18px; top:18px; background:#fff; border:1px solid var(--line); border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.08);
        padding:10px; z-index:50
    }
    .zoom-btn{
        display:block; width:42px;height:42px;border-radius:50%;border:none;background:#6366f1;color:#fff;cursor:pointer;font-size:18px;margin:6px auto
    }
    .note{font-size:12px;color:var(--muted)}
    .legend{display:flex; flex-wrap:wrap; gap:8px; margin-top:6px}
    .legend span{font-size:12px; padding:4px 8px; border-radius:6px; background:#f1f5f9; border:1px solid var(--line)}
    /* Breadcrumb */
    .breadcrumb{ font-weight:600 }
    /* Responsiv */
    @media (max-width: 720px){
        .title{font-size:24px}
    }
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="title">ğŸ§  LLM Deep Dive â€“ Die vollstÃ¤ndige, interaktive ErklÃ¤rung</div>
        <div class="controls">
            <button class="btn" onclick="expandAll()">ğŸ”„ Alles aufklappen</button>
            <button class="btn secondary" onclick="collapseAll()">ğŸ“ Alles zuklappen</button>
            <button class="btn ghost" onclick="resetView()">ğŸ  ZurÃ¼ck zum Start</button>
        </div>
    </div>

    <div class="path-indicator">
        <div><strong>ğŸ—ºï¸ Navigation:</strong> Klicke auf eine Karte, um Unterkapitel zu Ã¶ffnen/schlieÃŸen. Tiefe Ebenen erscheinen **direkt darunter** (ohne EinrÃ¼ckung).</div>
        <div><strong>Aktueller Pfad:</strong> <span id="breadcrumb" class="breadcrumb">Start</span></div>
        <div class="legend">
            <span>ğŸ“ Formeln</span><span>ğŸ‘ï¸ Diagramme</span><span>ğŸ’» Code</span><span>ğŸ”— Crossâ€‘Dependencies</span>
        </div>
    </div>

    <div class="zoom-controls">
        <button class="zoom-btn" onclick="zoomIn()">+</button>
        <button class="zoom-btn" onclick="zoomOut()">âˆ’</button>
        <button class="zoom-btn" onclick="resetZoom()">âŒ‚</button>
    </div>

    <div class="mindmap" id="mindmap" style="transform-origin: top left;">
        <!-- ROOT -->
        <div id="root" class="node level-0" data-path="LLM Deep Dive" onclick="toggleChildren(event,this)">
            ğŸ§­ LLM von Grund auf: Von Tokens zu Antworten
            <span class="expand-icon">â–¶</span>
            <small class="tagline">Tokenizer â†’ Embeddings/Position â†’ Transformerâ€‘Block â†’ Training â†’ Decoding â†’ Inferenz â†’ RAG/Tools â†’ Evaluation</small>

            <div class="children">

                <!-- EBENE 1: TOKENIZER -->
                <div id="tokenizer" class="node level-1" data-path="Tokenizer" onclick="toggleChildren(event,this)">
                    ğŸ”¤ Ebene 1: Tokenizer â€“ Wie Text zu Bausteinen wird
                    <span class="expand-icon">â–¶</span>
                    <small class="tagline">Byteâ€‘BPE & Unigram, Sondertoken, Unicode/Normalisierung, OOV, LÃ¤ngen/Kosten â†” Einfluss auf alle folgenden Ebenen</small>
                    <div class="children">

                        <!-- Warum SubwÃ¶rter -->
                        <div id="tok-why" class="node level-2" data-path="Warum SubwÃ¶rter?" onclick="toggleChildren(event,this)">
                            â“ Warum SubwÃ¶rter statt WÃ¶rter/Zeichen?
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>Motivation:</strong> Wortbasierte Vokabulare fÃ¼hren bei seltenen/komplexen WÃ¶rtern zu <em>UNK</em> (unbekannt). Zeichenbasierte Modelle explodieren in der SequenzlÃ¤nge. <strong>SubwÃ¶rter</strong> (BPE/Unigram) sind der Kompromiss: robust gegen OOV, aber deutlich kÃ¼rzere Sequenzen.</p>
                                    <div class="visual-diagram">
                                        <div class="flow">
                                            <svg viewBox="0 0 880 220">
                                                <rect x="10" y="20" width="260" height="180" rx="10" fill="#fff" stroke="#94a3b8" />
                                                <text x="140" y="40" text-anchor="middle" font-size="14" font-weight="bold">Wortâ€‘basiert</text>
                                                <text x="140" y="70" text-anchor="middle" font-size="12">"unhappiness" â†’ [UNK]</text>
                                                <text x="140" y="95" text-anchor="middle" font-size="12">V=2 Mio, kurz L</text>
                                                <text x="140" y="120" text-anchor="middle" font-size="12" fill="#ef4444">âŒ Viele UNKs</text>

                                                <rect x="310" y="20" width="260" height="180" rx="10" fill="#fff" stroke="#94a3b8" />
                                                <text x="440" y="40" text-anchor="middle" font-size="14" font-weight="bold">Zeichenâ€‘basiert</text>
                                                <text x="440" y="70" text-anchor="middle" font-size="12">"unhappiness" â†’ 11 Zeichen</text>
                                                <text x="440" y="95" text-anchor="middle" font-size="12">Vâ‰ˆ200, sehr lang L</text>
                                                <text x="440" y="120" text-anchor="middle" font-size="12" fill="#f59e0b">âš ï¸ LÂ²â€‘Kosten</text>

                                                <rect x="610" y="20" width="260" height="180" rx="10" fill="#fff" stroke="#94a3b8" />
                                                <text x="740" y="40" text-anchor="middle" font-size="14" font-weight="bold">Subwortâ€‘basiert</text>
                                                <text x="740" y="70" text-anchor="middle" font-size="12">"unâ€‘happâ€‘iâ€‘ness"</text>
                                                <text x="740" y="95" text-anchor="middle" font-size="12">Vâ‰ˆ50k, moderates L</text>
                                                <text x="740" y="120" text-anchor="middle" font-size="12" fill="#16a34a">âœ… Balance</text>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="crossdeps">
                                        ğŸ”— <strong>Crossâ€‘Dependencies:</strong>
                                        <span class="chip" onclick="jumpTo('inference')">Inferenzâ€‘Kosten</span>
                                        <span class="chip" onclick="jumpTo('embeddings')">Embeddingâ€‘Matrix</span>
                                        <span class="chip" onclick="jumpTo('decoding')">Decodingâ€‘Stil</span>
                                        <span class="chip" onclick="jumpTo('training')">Datenmischung</span>
                                        <span class="note">Mehr Tokens â†’ hÃ¶here LÂ²â€‘AufwÃ¤nde (Attention), mehr Speicher im KVâ€‘Cache.</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- BPE Training -->
                        <div id="tok-bpe" class="node level-2" data-path="Byte-Pair Encoding" onclick="toggleChildren(event,this)">
                            âœ‚ï¸ Byteâ€‘Pair Encoding (BPE) â€“ Training & Encoding
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>Idee:</strong> Beginne mit Zeichen. FÃ¼hre iterativ die <em>hÃ¤ufigste PaarzusammenfÃ¼gung</em> durch (z.â€¯B. <code>p</code>+<code>p</code>â†’<code>pp</code>), bis WortschatzgrÃ¶ÃŸe erreicht ist. Encoding wiederholt diese Merges deterministisch.</p>
                                    <div class="example-box">
                                        <strong>Miniâ€‘Beispiel (fiktive HÃ¤ufigkeiten):</strong><br>
                                        "unhappiness" â†’ ['u','n','h','a','p','p','i','n','e','s','s']<br>
                                        hÃ¤ufigste Paare: <code>p+p</code>, <code>n+e</code>, <code>ne+s</code>... â†’ Merges: <code>pp</code>, <code>ne</code>, <code>nes</code>â€¦<br>
                                        Ergebnis: <code>["un","happ","i","ness"]</code>
                                    </div>
                                    <div class="code-block"><button class="copy-btn" onclick="copyCode(this)">Copy</button><pre>
# Vereinfachter BPE-Trainingsablauf (Pseudocode)
counts = count_pair_frequencies(corpus_chars)
vocab = set(chars)
merges = []
while len(vocab) &lt; target_vocab:
    (a,b) = argmax_pair(counts)      # hÃ¤ufigstes Paar
    new_sym = a+b
    merges.append((a,b))
    vocab.add(new_sym)
    corpus_chars = merge_all(corpus_chars, (a,b))
    counts = update_pair_counts(counts, corpus_chars)
# Encoding: wende merges in dieser Reihenfolge auf neuen Text an</pre></div>
                                    <div class="crossdeps">
                                        ğŸ”— <strong>Crossâ€‘Dependencies:</strong>
                                        <span class="chip" onclick="jumpTo('tok-sp')">Unigram/SentencePiece</span>
                                        <span class="chip" onclick="jumpTo('embeddings')">Weightâ€‘Tying</span>
                                        <span class="chip" onclick="jumpTo('training')">Data Dedup</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Unigram -->
                        <div id="tok-sp" class="node level-2" data-path="Unigram (SentencePiece)" onclick="toggleChildren(event,this)">
                            ğŸ§® Unigram (SentencePiece) â€“ Probabilistische Alternative
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>Unigramâ€‘Modell:</strong> Starte mit groÃŸem Subwortkandidatenâ€‘Set und <em>entferne</em> nacheinander EintrÃ¤ge, die die Likelihood kaum verschlechtern. Encoding wÃ¤hlt die Subwortzerlegung mit maximaler Wahrscheinlichkeit (Viterbi/Dynamische Programmierung).</p>
                                    <div class="math-formula"><strong>Objektiv:</strong> maximiere <code>âˆ_tokens p(token)</code> Ã¼ber alle Zerlegungen eines Wortes</div>
                                    <p><em>Praktisch:</em> Besser bei agglutinierenden Sprachen; "weichere" Zerlegungen als BPE.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Sondertoken & Unicode -->
                        <div id="tok-special" class="node level-2" data-path="Sondertoken & Unicode" onclick="toggleChildren(event,this)">
                            ğŸ”– Sondertoken, Leerzeichen, Unicode & Normalisierung
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <ul>
                                        <li><strong>Sondertoken:</strong> BOS/EOS, Padding, Masken; in Chats zusÃ¤tzlich Rollen (system/user/assistant).</li>
                                        <li><strong>Whitespace:</strong> Viele Tokenizer modellieren fÃ¼hrende Leerzeichen explizit (z.â€¯B. â€Ä â€œ).</li>
                                        <li><strong>Unicode:</strong> Normalisierung (z.â€¯B. NFKC) vermeidet â€ÃŸâ€œ vs. â€ssâ€œ/â€Å¿â€œ, â€â€™â€œ vs. â€'â€œ â†’ <em>gleiche</em> Tokenisierung.</li>
                                        <li><strong>Byteâ€‘Fallback:</strong> Sicherer Pfad fÃ¼r vÃ¶llig unbekannte Zeichen â€“ nie â€unkâ€œ.</li>
                                    </ul>
                                    <div class="visual-diagram">
                                        <svg viewBox="0 0 800 180">
                                            <rect x="20" y="20" width="220" height="60" rx="10" fill="#fff" stroke="#94a3b8"/>
                                            <text x="130" y="45" text-anchor="middle" font-size="12">"StraÃŸe" / "Strasse"</text>
                                            <text x="130" y="65" text-anchor="middle" font-size="12">NFKC â†’ gleiche Tokens</text>

                                            <path d="M 240 50 L 300 50" stroke="#334155" stroke-width="2" marker-end="url(#arr1)"/>
                                            <rect x="310" y="20" width="220" height="60" rx="10" fill="#ecfeff" stroke="#06b6d4"/>
                                            <text x="420" y="45" text-anchor="middle" font-size="12">["Ä Stra", "ÃŸe"] = ["Ä Stra", "sse"]</text>

                                            <path d="M 530 50 L 590 50" stroke="#334155" stroke-width="2" marker-end="url(#arr1)"/>
                                            <rect x="600" y="20" width="180" height="60" rx="10" fill="#dcfce7" stroke="#16a34a"/>
                                            <text x="690" y="45" text-anchor="middle" font-size="12">Robustere Modelle</text>

                                            <defs>
                                                <marker id="arr1" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                                    <polygon points="0 0, 10 3.5, 0 7" fill="#334155"/>
                                                </marker>
                                            </defs>
                                        </svg>
                                    </div>
                                    <div class="crossdeps">
                                        ğŸ”— <strong>Crossâ€‘Dependencies:</strong>
                                        <span class="chip" onclick="jumpTo('decoding')">Logitâ€‘Bias/Verbote</span>
                                        <span class="chip" onclick="jumpTo('training')">Datenbereinigung</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Wirkung auf LÃ¤nge/Kosten -->
                        <div id="tok-cost" class="node level-2" data-path="SequenzlÃ¤nge & Kosten" onclick="toggleChildren(event,this)">
                            â±ï¸ SequenzlÃ¤nge & Kosten â€“ warum der Tokenizer alles beeinflusst
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p>Attention hat <strong>quadratische</strong> KomplexitÃ¤t in der SequenzlÃ¤nge <code>L</code>. Ein Tokenizer, der konstant 20â€¯% lÃ¤ngere Sequenzen erzeugt, erhÃ¶ht die Prefillâ€‘Kosten um ~44â€¯%.</p>
                                    <div class="math-formula">Skalierung: <code>O(LÂ²Â·d)</code> fÃ¼r QKáµ€ und AV, <code>O(L)</code> pro Token im Decode (mit KVâ€‘Cache)</div>
                                    <div class="crossdeps">
                                        ğŸ”— <strong>Crossâ€‘Dependencies:</strong>
                                        <span class="chip" onclick="jumpTo('inference-kv')">KVâ€‘Cache Speicher</span>
                                        <span class="chip" onclick="jumpTo('positional')">Positionskodierung</span>
                                        <span class="chip" onclick="jumpTo('flash')">FlashAttention</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div> <!-- /Tokenizer -->

                <!-- EBENE 2: EMBEDDINGS & POSITION -->
                <div id="embeddings" class="node level-1" data-path="Embeddings & Position" onclick="toggleChildren(event,this)">
                    ğŸ§± Ebene 2: Embeddings & Positionskodierung
                    <span class="expand-icon">â–¶</span>
                    <small class="tagline">Tokenâ€‘Vektoren, Weightâ€‘Tying, Residualâ€‘Stream, Sinus/ROPE/ALiBi und ihre Folgen fÃ¼r LÃ¤nge & Generalisierung</small>
                    <div class="children">

                        <div id="emb-core" class="node level-2" data-path="Token-Embeddings & LM-Head" onclick="toggleChildren(event,this)">
                            ğŸ”¡ Tokenâ€‘Embeddings & LMâ€‘Head (Weightâ€‘Tying)
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p>Ein Tokenâ€‘Index <em>i</em> wird per Lookup auf <em>E<sub>i</sub> âˆˆ â„<sup>d</sup></em> abgebildet (<code>d=d_model</code>). HÃ¤ufig wird der Ausgabelinearâ€‘Layer <em>W<sub>out</sub></em> mit <em>Eáµ€</em> <strong>geteilt</strong> (Weightâ€‘Tying) â†’ weniger Parameter, bessere Generalisierung.</p>
                                    <div class="math-formula">Logits: <code>z = h Â· Eáµ€</code> (bei Tying). Softmax: <code>p = softmax(z)</code></div>
                                    <div class="example-box"><strong>Geometrie:</strong> NÃ¤he im Vektorraum korreliert mit Substituierbarkeit; hochfrequente Tokens prÃ¤gen die Richtung des â€Meanâ€‘Vectorsâ€œ â†’ oft <em>Anisotropie</em> (korrigierbar per Norm/Centering).</div>
                                </div>
                            </div>
                        </div>

                        <div id="positional" class="node level-2" data-path="Positionskodierung" onclick="toggleChildren(event,this)">
                            ğŸ“ Positionskodierung: Sinus, ROPE, ALiBi
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <h3>Optionen & Intuition</h3>
                                    <ul>
                                        <li><strong>Sinusoidal (absolut):</strong> fixe Frequenzen, ermÃ¶glicht relative AbstÃ¤nde via linearen Kombinationen.</li>
                                        <li><strong>ROPE (rotary):</strong> interpretiert Paare von Features als 2Dâ€‘Rotation â†’ <em>relative</em> Phasenverschiebung in Q/K, gut fÃ¼r Skalierung Ã¼ber L.</li>
                                        <li><strong>ALiBi:</strong> addiert distanzabhÃ¤ngige Biasâ€‘Terme in die Scores, bevorzugt lokale BezÃ¼ge, skaliert schlicht auf groÃŸe L.</li>
                                    </ul>
                                    <div class="visual-diagram">
                                        <div class="flow">
                                            <svg viewBox="0 0 860 240">
                                                <text x="110" y="22" text-anchor="middle" font-weight="bold">Sinus</text>
                                                <path d="M20 60 C 60 20, 160 100, 200 60 S 340 20, 380 60" stroke="#7c3aed" fill="none" stroke-width="2"/>
                                                <text x="110" y="120" text-anchor="middle" font-size="12">feste, periodische Muster</text>

                                                <text x="430" y="22" text-anchor="middle" font-weight="bold">ROPE</text>
                                                <circle cx="430" cy="70" r="40" stroke="#0ea5e9" fill="none" stroke-width="2"/>
                                                <line x1="430" y1="70" x2="470" y2="70" stroke="#0ea5e9" stroke-width="2"/>
                                                <text x="430" y="120" text-anchor="middle" font-size="12">Rotation: posâ€‘abhÃ¤ngiger Winkel</text>

                                                <text x="740" y="22" text-anchor="middle" font-weight="bold">ALiBi</text>
                                                <rect x="660" y="50" width="160" height="40" rx="8" fill="#fff" stroke="#94a3b8"/>
                                                <text x="740" y="74" text-anchor="middle" font-size="12">Score += m Â· Distanz</text>
                                                <text x="740" y="120" text-anchor="middle" font-size="12">einfach, skaliert gut</text>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="math-formula"><strong>ROPE (vereinfacht):</strong> rotiere jedes (q<sub>2k</sub>, q<sub>2k+1</sub>) um Winkel Î¸(pos, k)</div>
                                    <div class="crossdeps">
                                        ğŸ”— <strong>Crossâ€‘Dependencies:</strong>
                                        <span class="chip" onclick="jumpTo('inference')">Lange Kontexte</span>
                                        <span class="chip" onclick="jumpTo('flash')">Speicherzugriffe</span>
                                        <span class="chip" onclick="jumpTo('transformer-mha')">Q/Kâ€‘Geometrie</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="residual" class="node level-2" data-path="Residual-Stream" onclick="toggleChildren(event,this)">
                            ğŸŒŠ Residualâ€‘Stream & Normierung â€“ StabilitÃ¤t & Tiefe
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p>Transformerâ€‘BlÃ¶cke addieren <em>Korrekturen</em> zum Residualâ€‘Strom. <strong>Preâ€‘LayerNorm</strong> fÃ¶rdert stabilen Gradientenfluss; <strong>RMSNorm</strong> ist leichtere Variante ohne Zentrierung.</p>
                                    <div class="math-formula">LayerNorm: <code>LN(x)=Î³âŠ™(xâˆ’Î¼)/âˆš(ÏƒÂ²+Îµ)+Î²</code> â€¢ RMSNorm: <code>x/âˆšE[xÂ²]</code></div>
                                    <div class="crossdeps">ğŸ”—
                                        <span class="chip" onclick="jumpTo('transformer-ffn')">FFN/SwiGLU</span>
                                        <span class="chip" onclick="jumpTo('training')">StabilitÃ¤tsâ€‘Tricks</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- EBENE 3: TRANSFORMER BLOCK -->
                <div id="transformer" class="node level-1" data-path="Transformer-Block" onclick="toggleChildren(event,this)">
                    ğŸ—ï¸ Ebene 3: Der Transformerâ€‘Block â€“ Attention + MLP
                    <span class="expand-icon">â–¶</span>
                    <small class="tagline">Q/K/V, kausale Maske, Multiâ€‘/Groupedâ€‘/Multiâ€‘Queryâ€‘Attention, FlashAttention, FFN & ParameterzÃ¤hlung</small>
                    <div class="children">

                        <div id="transformer-mha" class="node level-2" data-path="Multi-Head Attention" onclick="toggleChildren(event,this)">
                            ğŸ‘ï¸ Multiâ€‘Head Selfâ€‘Attention (MHSA)
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>Formen:</strong> Batch <em>B</em>, LÃ¤nge <em>L</em>, Dim <em>d</em>, KÃ¶pfe <em>h</em>, Kopfâ€‘Dim <em>d<sub>h</sub>=d/h</em>.</p>
                                    <div class="math-formula"><code>Attn(Q,K,V)=softmax((QKáµ€)/âˆšd_h + M) V</code></div>
                                    <div class="visual-diagram">
                                        <div class="flow">
                                            <svg viewBox="0 0 840 260">
                                                <rect x="20" y="20" width="180" height="60" rx="10" fill="#fff" stroke="#94a3b8"/>
                                                <text x="110" y="45" text-anchor="middle" font-size="12">X âˆˆ â„^{BÃ—LÃ—d}</text>
                                                <path d="M 200 50 L 240 50" stroke="#334155" stroke-width="2" marker-end="url(#arr2)"/>
                                                <rect x="250" y="20" width="200" height="60" rx="10" fill="#eef2ff" stroke="#6366f1"/>
                                                <text x="350" y="45" text-anchor="middle" font-size="12">Linear â†’ Q,K,V</text>

                                                <path d="M 450 50 L 490 50" stroke="#334155" stroke-width="2" marker-end="url(#arr2)"/>
                                                <rect x="500" y="20" width="150" height="60" rx="10" fill="#ecfeff" stroke="#06b6d4"/>
                                                <text x="575" y="45" text-anchor="middle" font-size="12">Headâ€‘Split</text>

                                                <path d="M 575 80 L 575 110" stroke="#334155" stroke-width="2" marker-end="url(#arr2)"/>
                                                <rect x="460" y="110" width="230" height="60" rx="10" fill="#dcfce7" stroke="#16a34a"/>
                                                <text x="575" y="145" text-anchor="middle" font-size="12">softmax((QKáµ€)/âˆšd_h + M)</text>

                                                <path d="M 575 170 L 575 210" stroke="#334155" stroke-width="2" marker-end="url(#arr2)"/>
                                                <rect x="460" y="210" width="230" height="40" rx="10" fill="#fef3c7" stroke="#f59e0b"/>
                                                <text x="575" y="235" text-anchor="middle" font-size="12">Â· V â†’ concat â†’ Linear W_O</text>

                                                <defs>
                                                    <marker id="arr2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                                        <polygon points="0 0, 10 3.5, 0 7" fill="#334155"/>
                                                    </marker>
                                                </defs>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="example-box">
                                        <strong>Kausale Maske:</strong> Verhindert Blick nach vorn (j&gt;i). <em>Ohne</em> Maske kein autoregressives Generieren.
                                    </div>
                                    <div class="crossdeps">ğŸ”—
                                        <span class="chip" onclick="jumpTo('positional')">ROPE/ALiBi</span>
                                        <span class="chip" onclick="jumpTo('inference-kv')">KVâ€‘Cache</span>
                                        <span class="chip" onclick="jumpTo('flash')">FlashAttention</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="mqa-gqa" class="node level-2" data-path="MQA/GQA" onclick="toggleChildren(event,this)">
                            ğŸ§  MQA/GQA â€“ Speicherleichte Attentionâ€‘Varianten
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>MQA:</strong> mehrere Queryâ€‘KÃ¶pfe teilen sich <em>ein</em> K/Vâ€‘Satz â†’ kleiner KVâ€‘Cache, schnellere Inferenz. <strong>GQA:</strong> Gruppen teilen K/V. Kleiner Tradeâ€‘off in QualitÃ¤t vs. groÃŸe Effizienzgewinne.</p>
                                    <div class="code-block"><button class="copy-btn" onclick="copyCode(this)">Copy</button><pre>
# Skizze: MQA in PyTorch-Stil (Pseudocode)
Q = q_proj(x).view(B,L,h,d_h)          # viele Queries
K = k_proj(x).view(B,L,1,d_h)          # geteilter Key
V = v_proj(x).view(B,L,1,d_h)          # geteilter Value
scores = (Q @ K.transpose(-1,-2)) / sqrt(d_h) + mask
A = softmax(scores, dim=-1)
H = (A @ V)          # broadcasting Ã¼ber den geteilten K/V-Kanal
out = o_proj(merge_heads(H))</pre></div>
                                    <div class="crossdeps">ğŸ”—
                                        <span class="chip" onclick="jumpTo('inference-kv')">KVâ€‘Speicherrechnung</span>
                                        <span class="chip" onclick="jumpTo('decoding')">Samplingâ€‘Durchsatz</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="flash" class="node level-2" data-path="FlashAttention" onclick="toggleChildren(event,this)">
                            âš¡ FlashAttention â€“ Speichergebundene Optimierung
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p>Reordnet die Berechnung in Kacheln (Blocks), fusioniert Softmax/Numerik, reduziert Speicherzugriffe â†’ <em>real</em> deutlich schneller bei langen Sequenzen.</p>
                                    <div class="example-box"><strong>Insight:</strong> Attention ist hÃ¤ufig <em>memoryâ€‘</em> nicht <em>computeâ€‘bound</em>. FlashAttention reduziert HBMâ€‘Transfers â†’ groÃŸe Gewinne.</div>
                                </div>
                            </div>
                        </div>

                        <div id="transformer-ffn" class="node level-2" data-path="FFN/SwiGLU" onclick="toggleChildren(event,this)">
                            ğŸ”§ FFN (MLP) & SwiGLU â€“ nichtlineare Projektionen
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p>Expandiere <code>d â†’ d_ff</code> (typisch 3â€“4Ã—), Aktvierung (GELU/SwiGLU), zurÃ¼ck auf <code>d</code>. <strong>SwiGLU</strong> (gated) steigert QualitÃ¤t bei Ã¤hnlichen FLOPs.</p>
                                    <div class="math-formula">SwiGLU: <code>(XW_a) âŠ™ SiLU(XW_b) Â· W_o</code></div>
                                </div>
                            </div>
                        </div>

                        <div id="params" class="node level-2" data-path="ParameterzÃ¤hlung" onclick="toggleChildren(event,this)">
                            ğŸ§® ParameterzÃ¤hlung â€“ konkrete Zahlen (Beispiel)
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p>Beispiel (illustrativ): <code>d=4096</code>, <code>h=32</code> â‡’ <code>d_h=128</code>, <code>d_ff=16384</code>, 32 Layer, Vokab 50k.</p>
                                    <ul>
                                        <li><strong>W_QKV</strong>: 4096Ã—(3Â·4096)=<strong>50,331,648</strong></li>
                                        <li><strong>W_O</strong>: 4096Ã—4096=<strong>16,777,216</strong> â†’ Attention pro Layer: <strong>67,108,864</strong></li>
                                        <li><strong>W_1</strong>: 4096Ã—16384=<strong>67,108,864</strong>, <strong>W_2</strong>: 16384Ã—4096=<strong>67,108,864</strong> â†’ MLP pro Layer: <strong>134,217,728</strong></li>
                                        <li><strong>Summe pro Layer</strong>: <strong>201,326,592</strong>; bei 32 Layern â‰ˆ <strong>6,442,450,944</strong></li>
                                        <li><strong>Embeddings</strong> (V=50k): 50kÃ—4096=<strong>204,800,000</strong> â†’ Gesamt â‰ˆ <strong>6.65â€¯B</strong></li>
                                    </ul>
                                    <div class="note">Zahlen ohne Bias/Normen, exemplarisch; reale Modelle variieren (SwiGLUâ€‘Skalierung, Tiefe, Heads).</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- EBENE 4: TRAINING / OPTIMIERUNG -->
                <div id="training" class="node level-1" data-path="Training & Optimierung" onclick="toggleChildren(event,this)">
                    ğŸ§ª Ebene 4: Training & Optimierung â€“ wie die Gewichte entstehen
                    <span class="expand-icon">â–¶</span>
                    <small class="tagline">Nextâ€‘Tokenâ€‘Ziel, Crossâ€‘Entropy/Perplexity, Datenpipeline, Optimierer & Schedules, StabilitÃ¤t, SFT/RLHF/DPO</small>
                    <div class="children">

                        <div id="obj" class="node level-2" data-path="Ziel & Perplexity" onclick="toggleChildren(event,this)">
                            ğŸ¯ Objektiv (Nextâ€‘Token), Crossâ€‘Entropy & Perplexity
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <div class="math-formula">maximiere <code>âˆ‘â‚œ log p_Î¸(x_t | x_{&lt;t})</code> â€¢ CEâ€‘Loss: <code>L=âˆ’log p_Î¸(y|x_{&lt;t})</code> â€¢ <strong>PPL</strong>=<code>exp(E[L])</code></div>
                                    <p><strong>Teacher Forcing</strong> im Training (Goldâ€‘Historie) vs. <strong>Exposure Bias</strong> in der Generierung (eigene Historie).</p>
                                </div>
                            </div>
                        </div>

                        <div id="data" class="node level-2" data-path="Datenpipeline" onclick="toggleChildren(event,this)">
                            ğŸ“š Datenpipeline â€“ Mischung, QualitÃ¤t, Dedup
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <ul>
                                        <li><strong>Mischung:</strong> Web/BÃ¼cher/Code/Foren/Artikel; balancierte DomÃ¤nen.</li>
                                        <li><strong>QualitÃ¤t:</strong> Heuristiken, Sprach/Charâ€‘Filter, Toxicityâ€‘Filter, Dokumentâ€‘LÃ¤nge.</li>
                                        <li><strong>Dedup:</strong> Hash/MinHash gegen Leaks/Lehrerâ€‘Ãœberanpassung.</li>
                                    </ul>
                                    <div class="crossdeps">ğŸ”—
                                        <span class="chip" onclick="jumpTo('tokenizer')">Tokenizerâ€‘Verteilung</span>
                                        <span class="chip" onclick="jumpTo('evaluation')">Evalâ€‘Generalisation</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="optim" class="node level-2" data-path="Optimierung" onclick="toggleChildren(event,this)">
                            âš™ï¸ Optimierung â€“ AdamW, Schedules & StabilitÃ¤t
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <ul>
                                        <li><strong>Optimierer:</strong> AdamW; Î²=(0.9, 0.95â€“0.999), Weight Decay getrennt.</li>
                                        <li><strong>LRâ€‘Schedule:</strong> Warmup â†’ Cosineâ€‘Decay; groÃŸe effektive Batches per Gradient Accumulation.</li>
                                        <li><strong>StabilitÃ¤t:</strong> Mixed Precision (bf16/fp16), Gradâ€‘Clipping, Preâ€‘LN, RMSNorm, Lossâ€‘Skalierung.</li>
                                        <li><strong>Parallelismus:</strong> Data/Tensor/Pipeline, ZeROâ€‘Sharding.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div id="alignment" class="node level-2" data-path="SFT/RLHF/DPO" onclick="toggleChildren(event,this)">
                            ğŸ›ï¸ SFT, RLHF & DPO â€“ von rohem LM zu hilfreichem Assistenten
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>SFT</strong> (Supervised Fineâ€‘Tuning) auf Anweisung/Antwortâ€‘Pairs; <strong>RLHF</strong> nutzt PrÃ¤ferenzmodelle; <strong>DPO</strong> optimiert direkt auf PrÃ¤ferenzverhÃ¤ltnisse ohne Policyâ€‘Rollouts.</p>
                                    <div class="example-box"><strong>Wichtig:</strong> Alignment Ã¤ndert das <em>Verhalten</em> (PrÃ¤ferenzen), nicht die KernfÃ¤higkeit des Nextâ€‘Tokenâ€‘Modells.</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- EBENE 5: DECODING -->
                <div id="decoding" class="node level-1" data-path="Decoding & Kalibrierung" onclick="toggleChildren(event,this)">
                    ğŸ° Ebene 5: Decoding & Kalibrierung â€“ vom Logit zur Antwort
                    <span class="expand-icon">â–¶</span>
                    <small class="tagline">Softmax/Temperatur, Topâ€‘k/Topâ€‘p/Typical, Beam & LÃ¤ngenpenalty, Repetitionâ€‘Penalty, Logitâ€‘Bias, Grammatikâ€‘Sampling</small>
                    <div class="children">

                        <div id="softmax" class="node level-2" data-path="Softmax & Temperatur" onclick="toggleChildren(event,this)">
                            ğŸŒ¡ï¸ Softmax, Temperatur & Kalibrierung
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <div class="math-formula"><code>p_i = exp(z_i/T) / âˆ‘_j exp(z_j/T)</code></div>
                                    <div class="example-box">
                                        <strong>Beispiel:</strong> Logits [2.1, 1.3, 0.8, âˆ’0.5] â†’ <em>T=1</em>: [0.56, 0.25, 0.15, 0.04].<br>
                                        <em>T=0.7</em> spitzer; <em>T=1.5</em> flacher.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="sampling" class="node level-2" data-path="Sampling-Strategien" onclick="toggleChildren(event,this)">
                            ğŸ² Samplingâ€‘Strategien (Greedy, Topâ€‘k, Topâ€‘p, Typical)
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <ul>
                                        <li><strong>Greedy:</strong> hÃ¶chstes p â€“ deterministisch, repetitiv.</li>
                                        <li><strong>Topâ€‘k:</strong> nur beste k Tokens, renormalisieren.</li>
                                        <li><strong>Topâ€‘p (Nucleus):</strong> kleinste Menge mit kumulativ â‰¥ p.</li>
                                        <li><strong>Typical:</strong> PrÃ¤ferenz fÃ¼r Tokens nahe Entropie â†’ vermeidet â€zu erwartbareâ€œ und â€zu Ã¼berraschendeâ€œ.</li>
                                    </ul>
                                    <div class="code-block"><button class="copy-btn" onclick="copyCode(this)">Copy</button><pre>
# Top-p (Nucleus) Sampling, PyTorch-Skizze
def nucleus_sample(logits, p=0.9, temperature=1.0):
    z = logits / temperature
    probs = torch.softmax(z, dim=-1)
    sp, si = torch.sort(probs, descending=True)
    csum = torch.cumsum(sp, dim=-1)
    cutoff = torch.searchsorted(csum, torch.tensor(p, device=csum.device))
    sp[cutoff+1:] = 0.0
    sp = sp / sp.sum()
    idx = torch.multinomial(sp, 1)
    return si.gather(-1, idx)</pre></div>
                                    <div class="crossdeps">ğŸ”—
                                        <span class="chip" onclick="jumpTo('alignment')">PrÃ¤ferenzmodelle</span>
                                        <span class="chip" onclick="jumpTo('inference')">Durchsatz pro Token</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="constraints" class="node level-2" data-path="Nebenbedingungen" onclick="toggleChildren(event,this)">
                            ğŸ§© Nebenbedingungen: Beam, LÃ¤ngenâ€‘Penalty, Repetition/Logitâ€‘Bias, Grammatik
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <ul>
                                        <li><strong>Beam Search:</strong> behÃ¤lt k beste Hypothesen â€“ gut fÃ¼r deterministische Aufgaben, riskant fÃ¼r offene Generierung.</li>
                                        <li><strong>LÃ¤ngenâ€‘Penalty:</strong> verhindert zu kurze Antworten bei Beam.</li>
                                        <li><strong>Repetition Penalty / nâ€‘Gramâ€‘Block:</strong> reduziert Wiederholungen.</li>
                                        <li><strong>Logitâ€‘Bias & Stopâ€‘Seq:</strong> erzwinge/verbiete Muster.</li>
                                        <li><strong>Grammarâ€‘Sampling:</strong> generiere nur Strings, die einer Grammatik entsprechen (JSON/XML etc.).</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- EBENE 6: INFERENCE & EFFIZIENZ -->
                <div id="inference" class="node level-1" data-path="Inferenz & Effizienz" onclick="toggleChildren(event,this)">
                    âš¡ Ebene 6: Inferenz & Effizienz â€“ schnell & speicherschonend
                    <span class="expand-icon">â–¶</span>
                    <small class="tagline">Prefill vs Decode, KVâ€‘Cacheâ€‘Mathematik, Paged Attention, Quantisierung, Speculative Decoding</small>
                    <div class="children">

                        <div id="inference-steps" class="node level-2" data-path="Prefill & Decode" onclick="toggleChildren(event,this)">
                            â© Prefill & Decode â€“ zwei Phasen
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>Prefill:</strong> gesamten Prompt einmal rechnen (LÂ²â€‘Aufwand, baut KVâ€‘Cache). <strong>Decode:</strong> pro neuem Token nur letzte Spalte/Zeile (âˆ L) dank Cache.</p>
                                </div>
                            </div>
                        </div>

                        <div id="inference-kv" class="node level-2" data-path="KV-Cache-Rechnung" onclick="toggleChildren(event,this)">
                            ğŸ§Š KVâ€‘Cache â€“ exakte Speicherrechnung (Beispiel)
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p>Beispiel: <em>L=8192</em>, <em>h=32</em>, <em>d_h=128</em>, 2 Matrizen (K&V), Datentyp 2â€¯Byte (fp16/bf16), Batch=1.</p>
                                    <ul>
                                        <li>Elemente pro Layer: <code>2 Ã— L Ã— h Ã— d_h = 2 Ã— 8192 Ã— 32 Ã— 128 = 67,108,864</code></li>
                                        <li>Bytes pro Layer: <code>â‰ˆ134,217,728</code>â€¯B = <strong>128â€¯MiB</strong></li>
                                        <li>Bei 32 Layern: <strong>â‰ˆ4â€¯GiB</strong> nur Cache</li>
                                    </ul>
                                    <div class="crossdeps">ğŸ”—
                                        <span class="chip" onclick="jumpTo('mqa-gqa')">MQA/GQA</span>
                                        <span class="chip" onclick="jumpTo('tokenizer')">TokenlÃ¤nge</span>
                                        <span class="chip" onclick="jumpTo('positional')">Lange Kontexte</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="quant" class="node level-2" data-path="Quantisierung" onclick="toggleChildren(event,this)">
                            ğŸšï¸ Quantisierung (int8/int4), Outlierâ€‘Handling & LoRA
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>Ziel:</strong> Gewichte/Aktivierungen in niedrigere PrÃ¤zision Ã¼berfÃ¼hren. <em>Outlierâ€‘Channels</em> erfordern besondere Behandlung (z.â€¯B. Gruppierungsâ€‘/Skalen pro Kanal). <strong>LoRA</strong> fÃ¼gt Lowâ€‘Rankâ€‘Adapter hinzu (feinabstimmen ohne Fullâ€‘finetune).</p>
                                </div>
                            </div>
                        </div>

                        <div id="spec" class="node level-2" data-path="Speculative Decoding" onclick="toggleChildren(event,this)">
                            ğŸ§ª Speculative Decoding â€“ schnelleres Sampling
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p>Ein kleiner â€Draftâ€œâ€‘Decoder schlÃ¤gt eine Sequenz vor; der groÃŸe prÃ¼ft sie in einem Schritt. Bei hoher Ãœbereinstimmung: erhebliche Geschwindigkeit, da mehrere Tokens pro Verifikation bestÃ¤tigt werden.</p>
                                </div>
                            </div>
                        </div>

                        <div id="paged" class="node level-2" data-path="Paged/Sliding Attention" onclick="toggleChildren(event,this)">
                            ğŸ“„ Paged/Sliding Attention â€“ Speicher fragmentieren & schieben
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p><strong>Paged:</strong> KVâ€‘Cache in Seiten (Pagedâ€‘Memory) â†’ weniger Realloc/Fragmentierung. <strong>Slidingâ€‘Window:</strong> beschrÃ¤nke Aufmerksamkeit auf letztes Fenster â†’ Liniearer Speicherbedarf in L.</p>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- EBENE 7: RAG & TOOLS -->
                <div id="rag" class="node level-1" data-path="RAG & Tools" onclick="toggleChildren(event,this)">
                    ğŸ§© Ebene 7: RAG & Toolâ€‘Nutzung â€“ Grounding & Erweiterung
                    <span class="expand-icon">â–¶</span>
                    <small class="tagline">Retrievalâ€‘Augmented Generation, Vektorâ€‘Suche, Crossâ€‘/Biâ€‘Encoder, Funktionsaufrufe</small>
                    <div class="children">

                        <div id="rag-core" class="node level-2" data-path="RAG-Pipeline" onclick="toggleChildren(event,this)">
                            ğŸ” RAGâ€‘Pipeline â€“ vom Query zur verankerten Antwort
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <ol>
                                        <li><strong>Embed</strong> Nutzerfrage â†’ Vektor.</li>
                                        <li><strong>Retrieve</strong> Ã¤hnliche Passagen (Vektorâ€‘Index).</li>
                                        <li><strong>Augment</strong> Prompt mit Kontext.</li>
                                        <li><strong>Generate</strong> Antwort (Nextâ€‘Token wie gehabt) â€“ jetzt <em>geerdet</em>.</li>
                                    </ol>
                                    <div class="crossdeps">ğŸ”—
                                        <span class="chip" onclick="jumpTo('embeddings')">Embeddingâ€‘QualitÃ¤t</span>
                                        <span class="chip" onclick="jumpTo('decoding')">Kalibrierung</span>
                                        <span class="chip" onclick="jumpTo('training')">DomÃ¤nenmischung</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="tools" class="node level-2" data-path="Tools/Functions" onclick="toggleChildren(event,this)">
                            ğŸ› ï¸ Tools/Functionâ€‘Calling â€“ Rechnen, Suche, Code
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <p>Das LM erzeugt strukturierte <em>Aufrufe</em> (z.â€¯B. JSON) fÃ¼r externe Tools; deren Ergebnisse flieÃŸen als Kontext zurÃ¼ck. Gewichte bleiben unverÃ¤ndert â€“ nur die <em>Konditionierung</em> Ã¤ndert sich.</p>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- EBENE 8: EVALUATION & SAFETY -->
                <div id="evaluation" class="node level-1" data-path="Evaluation & Verhalten" onclick="toggleChildren(event,this)">
                    ğŸ“ Ebene 8: Evaluation, Kalibrierung & Verhalten
                    <span class="expand-icon">â–¶</span>
                    <small class="tagline">Perplexity vs. Taskâ€‘Scores, Halluzination, Unsicherheitskommunikation, Safetyâ€‘Hinweise</small>
                    <div class="children">

                        <div id="eval-metrics" class="node level-2" data-path="Metriken" onclick="toggleChildren(event,this)">
                            ğŸ“Š Metriken â€“ was misst was?
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <ul>
                                        <li><strong>Perplexity:</strong> SprachmodellgÃ¼te (<em>intrinsisch</em>), nicht gleich Taskleistung.</li>
                                        <li><strong>Extrinsisch:</strong> QA/Code/Reasoningâ€‘Benchmarks.</li>
                                        <li><strong>Kalibrierung:</strong> passt p(y) zu HÃ¤ufigkeiten?</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div id="eval-safety" class="node level-2" data-path="Safety" onclick="toggleChildren(event,this)">
                            ğŸ›¡ï¸ Verhalten & Safety â€“ Grenzen & Praxis
                            <span class="expand-icon">â–¶</span>
                            <div class="children">
                                <div class="section">
                                    <ul>
                                        <li><strong>Halluzination:</strong> fehlende Evidenz â†’ plausible Erfindungen. Gegenmittel: RAG/Verweise/Unsicherheiten artikulieren.</li>
                                        <li><strong>Promptâ€‘Injektionen:</strong> externe Texte kÃ¶nnen Instruktionen Ã¼berschreiben â€“ GegenmaÃŸnahmen: Parser/Filter, sichere Toolâ€‘Schnittstellen.</li>
                                        <li><strong>Bias & Fairness:</strong> Trainingsdaten prÃ¤gen Stil & Inhalt.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- EBENE 9: CHEAT-SHEET -->
                <div id="cheatsheet" class="node level-1" data-path="Cheat-Sheet" onclick="toggleChildren(event,this)">
                    ğŸ§¾ Ebene 9: Cheatâ€‘Sheet â€“ das Wichtigste in KÃ¼rze
                    <span class="expand-icon">â–¶</span>
                    <div class="children">
                        <div class="section">
                            <ul>
                                <li><strong>Modell:</strong> bedingter Nextâ€‘Tokenâ€‘Generator <code>p(x_t|x_{&lt;t})</code>.</li>
                                <li><strong>Kernâ€‘Block:</strong> (Normâ†’Attentionâ†’Res) + (Normâ†’MLPâ†’Res).</li>
                                <li><strong>Skalierung:</strong> Kosten âˆ LÂ² (Prefill), Speicher âˆ LÂ·hÂ·d_hÂ·Layer.</li>
                                <li><strong>Decoding:</strong> Topâ€‘p meist robust, Typical fÃ¼r â€natÃ¼rlicheâ€œ Vielfalt.</li>
                                <li><strong>Effizienz:</strong> KVâ€‘Cache, FlashAttention, MQA/GQA, Quantisierung.</li>
                                <li><strong>Grounding:</strong> RAG/Tools, Kalibrierung kommunizieren.</li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div><!-- /children root -->
        </div><!-- /root -->
    </div><!-- /mindmap -->
</div><!-- /container -->

<script>
/* =============== State & Breadcrumb =============== */
let currentZoom = 1;
let breadcrumbPath = ["Start"];

/* Persist offen/zu pro Node (optional) */
const STORAGE_KEY = "llm_deep_dive_open_nodes_v1";

/* Toggle-Handler */
function toggleChildren(ev, node){
    ev.stopPropagation();
    const children = node.querySelector(':scope > .children'); // nur direkte children
    if(!children) return;

    const id = node.id || node.getAttribute('data-path');
    children.classList.toggle('expanded');
    node.classList.toggle('expanded');

    // Breadcrumb aktualisieren (einfacher Heuristikpfad)
    const pathData = node.getAttribute('data-path');
    if(pathData && children.classList.contains('expanded')){
        if(!breadcrumbPath.includes(pathData)) breadcrumbPath.push(pathData);
    } else if(pathData){
        const idx = breadcrumbPath.indexOf(pathData);
        if(idx > -1){ breadcrumbPath.splice(idx); }
    }
    updateBreadcrumb();

    // Persistenz
    saveOpenState();
}
function updateBreadcrumb(){
    document.getElementById('breadcrumb').textContent = breadcrumbPath.join(' â†’ ');
}

/* Expand/Collapse All */
function expandAll(){
    document.querySelectorAll('.children').forEach(c => c.classList.add('expanded'));
    document.querySelectorAll('.node').forEach(n => n.classList.add('expanded'));
    // Pfad grob
    breadcrumbPath = ["Start", "Alles geÃ¶ffnet"];
    updateBreadcrumb();
    saveOpenState();
}
function collapseAll(){
    document.querySelectorAll('.children').forEach(c => c.classList.remove('expanded'));
    document.querySelectorAll('.node').forEach(n => n.classList.remove('expanded'));
    breadcrumbPath = ["Start"];
    updateBreadcrumb();
    saveOpenState();
}
function resetView(){
    collapseAll();
    resetZoom();
    window.scrollTo({top:0, behavior:"smooth"});
}

/* Zoom */
function applyZoom(){
    document.getElementById('mindmap').style.transform = `scale(${currentZoom})`;
}
function zoomIn(){ currentZoom = Math.min(currentZoom*1.2, 3); applyZoom(); }
function zoomOut(){ currentZoom = Math.max(currentZoom/1.2, 0.5); applyZoom(); }
function resetZoom(){ currentZoom = 1; applyZoom(); }

/* Copy Code */
function copyCode(btn){
    const pre = btn.parentElement.querySelector('pre');
    const text = pre.innerText;
    navigator.clipboard.writeText(text).then(()=>{
        btn.textContent = "Copied!";
        setTimeout(()=>btn.textContent="Copy", 1200);
    }).catch(()=>{ btn.textContent="Error"; setTimeout(()=>btn.textContent="Copy", 1200); });
}

/* Cross-Dependency Jump & Highlight */
function jumpTo(id){
    const el = document.getElementById(id);
    if(!el) return;
    // Stelle sicher, dass Eltern aufgeklappt sind
    openAncestors(el);
    // sanft scrollen + highlight
    el.scrollIntoView({behavior:"smooth", block:"center"});
    el.classList.add('highlight');
    setTimeout(()=>el.classList.remove('highlight'), 1200);
}
function openAncestors(el){
    let cur = el;
    while(cur){
        const parentNode = cur.closest('.children')?.parentElement;
        if(parentNode && parentNode.classList.contains('node')){
            parentNode.classList.add('expanded');
            const ch = parentNode.querySelector(':scope > .children');
            if(ch) ch.classList.add('expanded');
        }
        cur = parentNode;
    }
    saveOpenState();
}

/* Persistenz-Helper */
function saveOpenState(){
    const openIds = Array.from(document.querySelectorAll('.node.expanded')).map(n => n.id || n.getAttribute('data-path'));
    try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(openIds)); }catch(e){}
}
function restoreOpenState(){
    let arr = [];
    try{ arr = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }catch(e){}
    if(!Array.isArray(arr)) return;
    arr.forEach(id =>{
        const n = document.getElementById(id) || document.querySelector(`.node[data-path="${CSS.escape(id)}"]`);
        if(n){
            n.classList.add('expanded');
            const ch = n.querySelector(':scope > .children');
            if(ch) ch.classList.add('expanded');
        }
    });
    if(arr.length){ breadcrumbPath = ["Start", "Fortgesetzte Ansicht"]; updateBreadcrumb(); }
}

/* Init */
document.addEventListener('DOMContentLoaded', ()=>{
    restoreOpenState();
    updateBreadcrumb();
});
</script>
</body>
</html>
